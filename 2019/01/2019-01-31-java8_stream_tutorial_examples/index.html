<!DOCTYPE html><html lang="lang"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="java stream 예제"><meta name="keywords" content="java stream"><meta name="author" content="sejoung"><meta name="copyright" content="sejoung"><title>java stream 예제 | 폭간의 기술블로그</title><link rel="shortcut icon" href="../../../my-favicon.ico"><link rel="stylesheet" href="../../../css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><script async src="https://www.googletagmanager.com/gtag/js?id=G-NVRTGLD8RZ"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-NVRTGLD8RZ');</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 5.4.2"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#java-stream-%EC%98%88%EC%A0%9C"><span class="toc-number">1.</span> <span class="toc-text">java stream 예제</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EC%8A%A4%ED%8A%B8%EB%A6%BC%EC%9D%98-%EC%9E%91%EB%8F%99-%EB%B0%A9%EC%8B%9D"><span class="toc-number">1.1.</span> <span class="toc-text">스트림의 작동 방식</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EB%8B%A4%EB%A5%B8-%EC%A2%85%EB%A5%98%EC%9D%98-%EC%8A%A4%ED%8A%B8%EB%A6%BC"><span class="toc-number">1.2.</span> <span class="toc-text">다른 종류의 스트림</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Processing-Order"><span class="toc-number">1.3.</span> <span class="toc-text">Processing Order</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%EC%A3%BC%EB%AC%B8-%EB%AC%B8%EC%A0%9C%EA%B0%80%EC%9E%88%EB%8A%94-%EC%9D%B4%EC%9C%A0"><span class="toc-number">1.3.1.</span> <span class="toc-text">주문 문제가있는 이유</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EC%8A%A4%ED%8A%B8%EB%A6%BC-%EC%9E%AC%EC%82%AC%EC%9A%A9"><span class="toc-number">1.4.</span> <span class="toc-text">스트림 재사용</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EA%B3%A0%EA%B8%89-%EC%9E%91%EC%97%85"><span class="toc-number">1.5.</span> <span class="toc-text">고급 작업</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Collect"><span class="toc-number">1.5.1.</span> <span class="toc-text">Collect</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#FlatMap"><span class="toc-number">1.5.2.</span> <span class="toc-text">FlatMap</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Reduce"><span class="toc-number">1.5.3.</span> <span class="toc-text">Reduce</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EB%B3%91%EB%A0%AC-%EC%8A%A4%ED%8A%B8%EB%A6%BC"><span class="toc-number">1.6.</span> <span class="toc-text">병렬 스트림</span></a></li></ol></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#%EC%B0%B8%EC%A1%B0"><span class="toc-number"></span> <span class="toc-text">참조</span></a></li></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://avatars0.githubusercontent.com/u/4936005?s=400&amp;u=a679b941fe377418e7e4efcf916c6a636d7178ee&amp;v=4"></div><div class="author-info__name text-center">sejoung</div><div class="author-info__description text-center">잘정리하자</div><div class="follow-button"><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/sejoung">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="../../../archives"><span class="pull-left">Articles</span><span class="pull-right">775</span></a><a class="author-info-articles__tags article-meta" href="../../../tags"><span class="pull-left">Tags</span><span class="pull-right">810</span></a><a class="author-info-articles__categories article-meta" href="../../../categories"><span class="pull-left">Categories</span><span class="pull-right">75</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.naver.com/sanaes">naverblog</a><a class="author-info-links__name text-center" target="_blank" rel="external nofollow noopener noreferrer" href="https://www.linkedin.com/in/sanaes/">linkedin</a><a class="author-info-links__name text-center" target="_blank" rel="external nofollow noopener noreferrer" href="https://www.slideshare.net/sejoung">slideshare</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://upload.wikimedia.org/wikipedia/commons/thumb/0/09/Van_Gogh_-_Terrasse_des_Caf%C3%A9s_an_der_Place_du_Forum_in_Arles_am_Abend1.jpeg/1024px-Van_Gogh_-_Terrasse_des_Caf%C3%A9s_an_der_Place_du_Forum_in_Arles_am_Abend1.jpeg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="../../../index.html">폭간의 기술블로그</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">java stream 예제</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-01-31</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="../../../categories/java/">java</a><span class="post-meta__separator">|</span><i class="fa fa-comment-o post-meta__icon" aria-hidden="true"></i><a href="#disqus_thread"><span class="disqus-comment-count" data-disqus-identifier="2019/01/2019-01-31-java8_stream_tutorial_examples/"></span></a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h3 id="java-stream-예제"><a href="#java-stream-예제" class="headerlink" title="java stream 예제"></a>java stream 예제</h3><p>여기에 글을 번역한 것입니다. <a target="_blank" rel="external nofollow noopener noreferrer" href="https://winterbe.com/posts/2014/07/31/java8-stream-tutorial-examples/">java8-stream-tutorial-examples</a></p>
<p>이 예제 중심 자습서에서는 Java 8 스트림에 대한 심층적 인 개요를 제공합니다. StreamAPI 에 대해 처음 읽었을 때 Java I &#x2F; O InputStream와 비슷하게 들리며 이름에 대해 혼란스러워했습니다 OutputStream. 하지만 Java 8 스트림은 완전히 다른 것입니다. 스트림은 모나드 이므로, 자바에 기능적 프로그래밍 을 가져 오는 데 큰 역할을합니다 .</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">함수 프로그래밍에서 모나드는 일련의 계단으로 정의 된 계산을 나타내는 구조입니다. </span><br><span class="line">모나드 구조가있는 형식은 연산을 연결하는 의미와 해당 형식의 함수를 함께 정의합니다.</span><br></pre></td></tr></table></figure>

<p>이 가이드는 Java 8 스트림을 사용하여 작업하는 방법과 다양한 종류의 사용 가능한 스트림 작업을 사용하는 방법을 설명합니다. 처리 순서 및 스트림 작업의 순서가 런타임 성능에 미치는 영향에 대해 학습합니다. 더 강력한 스트림 작업 reduce, collect그리고 flatMap자세히 설명합니다. 이 튜토리얼은 병렬 스트림에 대한 심층적 인 설명으로 끝납니다.</p>
<h4 id="스트림의-작동-방식"><a href="#스트림의-작동-방식" class="headerlink" title="스트림의 작동 방식"></a>스트림의 작동 방식</h4><p>스트림은 일련의 요소를 나타내며 이러한 요소에 대한 계산을 수행하는 다른 종류의 연산을 지원합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HowStreamsWork</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;String&gt; myList = List.of(<span class="string">&quot;a1&quot;</span>, <span class="string">&quot;a2&quot;</span>, <span class="string">&quot;b1&quot;</span>, <span class="string">&quot;c2&quot;</span>, <span class="string">&quot;c1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        myList</span><br><span class="line">                .stream()</span><br><span class="line">                .filter(s -&gt; s.startsWith(<span class="string">&quot;c&quot;</span>))</span><br><span class="line">                .map(String::toUpperCase)</span><br><span class="line">                .sorted()</span><br><span class="line">                .forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">C1</span><br><span class="line">C2</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>스트림 작업은 중간 또는 터미널입니다.<br>중간 작업은 스트림을 반환하므로 세미콜론을 사용하지 않고 여러 중간 작업을 연결할 수 있습니다.<br>터미널 작업은 void이거나 비 스트림 결과를 반환합니다. </p>
<p>위의 예 filter에서 map, sorted은 forEach 터미널 작업의  중간 작업입니다.<br>사용 가능한 모든 스트림 작업의 전체 목록은 Stream Javadoc을 참조하십시오 . </p>
<p>위 예에서 볼 수있는 이러한 스트림 작업 체인은 작업 파이프 라인 이라고도 합니다 .</p>
<p>대부분의 스트림 연산은 어떤 종류의 람다 표현식 매개 변수 (operation)의 정확한 동작을 지정하는 기능적 인터페이스를 허용합니다.<br>이러한 작업의 대부분은 간섭이 없고 상태가 없어야합니다 . </p>
<p>그게 무슨 뜻 이죠?</p>
<p>함수는 스트림의 기본 데이터 소스를 수정하지 않을 때 간섭을받지 않습니다.<br>예를 들어 위 예제에서 람다 표현식은 myList컬렉션에 요소를 추가하거나 제거하여 수정하지 않습니다.</p>
<p>함수의 실행이 결정적이라면 함수는 상태 가 없습니다.<br>예를 들어 위의 예제에서 실행 중에 변경 될 수있는 외부 범위의 변경 가능한 변수 나 상태에 따라 람다식이 달라지지는 않습니다.</p>
<h4 id="다른-종류의-스트림"><a href="#다른-종류의-스트림" class="headerlink" title="다른 종류의 스트림"></a>다른 종류의 스트림</h4><p>스트림은 다양한 데이터 소스, 특히 컬렉션에서 만들 수 있습니다.<br>목록 및 세트 새로운 방법을 지원 stream()하고 parallelStream()중 하나에하는 것은 순차적 또는 병렬 스트림을 생성합니다.<br>병렬 스트림은 여러 스레드에서 작동 할 수 있으며이 자습서의 뒷부분에서 다룰 예정입니다.<br>현재 순차적 스트림에 중점을 둡니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DifferentKindOfStreams</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List.of(<span class="string">&quot;a1&quot;</span>, <span class="string">&quot;a2&quot;</span>, <span class="string">&quot;a3&quot;</span>)</span><br><span class="line">                .stream()</span><br><span class="line">                .findFirst()</span><br><span class="line">                .ifPresent(System.out::println);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">a1</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>stream()객체 목록 에서 메소드 를 호출하면 일반 객체 스트림이 반환됩니다.<br>그러나 우리는 다음 코드 샘플에서 볼 수있는 것처럼 스트림을 다루기 위해 컬렉션을 생성 할 필요가 없습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DifferentKindOfStreams</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Stream.of(<span class="string">&quot;a1&quot;</span>, <span class="string">&quot;a2&quot;</span>, <span class="string">&quot;a3&quot;</span>)</span><br><span class="line">                .findFirst()</span><br><span class="line">                .ifPresent(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">a1</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>Stream.of()한 무리의 객체 참조에서 스트림을 만드는 데 사용 하십시오.</p>
<p>게다가 일반 개체는 기본 데이터 형(int, long하고 double) 작업을 위한 자바에게 스트림의 특별한 종류를 제공한다.<br>당신이 짐작 했겠지만 IntStream, LongStream그리고 DoubleStream.</p>
<p>IntStreams는 for 루프를 사용하여 일반 for를 대체 할 수 있습니다 IntStream.range().</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.stream.IntStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DifferentKindOfStreams</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        IntStream.range(<span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">                .forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>이러한 모든 원시 스트림은 다음과 같은 차이점이있는 일반 객체 스트림과 동일하게 작동합니다.<br>원시 스트림은 추가 터미널 집계 연산(sum(), average())을 지원하며 특수 λ 식을 사용합니다<br>(예 : IntFunction대신 Function또는 IntPredicate대신 Predicate). </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DifferentKindOfStreams</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Arrays.stream(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;)</span><br><span class="line">                .map(n -&gt; <span class="number">2</span> * n + <span class="number">1</span>)</span><br><span class="line">                .average()</span><br><span class="line">                .ifPresent(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">5.0</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>때로는 일반 객체 스트림을 원시 스트림으로 변환하거나 그 반대로 변환하는 것이 유용합니다.<br>이를 위해 객체 스트림은 특별한 매핑 작업(mapToInt(), mapToLong()및 mapToDouble())을 지원</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DifferentKindOfStreams</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Stream.of(<span class="string">&quot;a1&quot;</span>, <span class="string">&quot;a2&quot;</span>, <span class="string">&quot;a3&quot;</span>)</span><br><span class="line">                .map(s -&gt; s.substring(<span class="number">1</span>))</span><br><span class="line">                .mapToInt(Integer::parseInt)</span><br><span class="line">                .max()</span><br><span class="line">                .ifPresent(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>원시 스트림은 다음을 통해 객체 스트림(mapToObj())으로 변환 될 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.stream.IntStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DifferentKindOfStreams</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        IntStream.range(<span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">                .mapToObj(i -&gt; <span class="string">&quot;a&quot;</span> + i)</span><br><span class="line">                .forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">a1</span><br><span class="line">a2</span><br><span class="line">a3</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>다음은 결합 된 예제입니다. double의 스트림은 먼저 int 스트림에 매핑되고 string의 객체 스트림에 매핑됩니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DifferentKindOfStreams</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">     </span><br><span class="line">        Stream.of(<span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>)</span><br><span class="line">                .mapToInt(Double::intValue)</span><br><span class="line">                .mapToObj(i -&gt; <span class="string">&quot;a&quot;</span> + i)</span><br><span class="line">                .forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">a1</span><br><span class="line">a2</span><br><span class="line">a3</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<h4 id="Processing-Order"><a href="#Processing-Order" class="headerlink" title="Processing Order"></a>Processing Order</h4><p>다양한 종류의 스트림을 만들고 작동하는 방법을 배웠으므로 이제 스트림 작동이 어떻게 처리되는지 자세히 살펴 보겠습니다.</p>
<p>중간 작업의 중요한 특징은 lazy입니다. 터미널 작동이없는이 샘플을보십시오.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProcessingOrder</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Stream.of(<span class="string">&quot;d2&quot;</span>, <span class="string">&quot;a2&quot;</span>, <span class="string">&quot;b1&quot;</span>, <span class="string">&quot;b3&quot;</span>, <span class="string">&quot;c&quot;</span>)</span><br><span class="line">                .filter(s -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;filter: &quot;</span> + s);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>이 코드 스니펫을 실행할 때 콘솔에 아무 것도 인쇄되지 않습니다.<br>중간 작업은 터미널 작업이있을 때만 실행되기 때문입니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProcessingOrder</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Stream.of(<span class="string">&quot;d2&quot;</span>, <span class="string">&quot;a2&quot;</span>, <span class="string">&quot;b1&quot;</span>, <span class="string">&quot;b3&quot;</span>, <span class="string">&quot;c&quot;</span>)</span><br><span class="line">                .filter(s -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;filter: &quot;</span> + s);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;).forEach(s -&gt; System.out.println(<span class="string">&quot;forEach: &quot;</span> + s));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">filter: d2</span><br><span class="line">forEach: d2</span><br><span class="line">filter: a2</span><br><span class="line">forEach: a2</span><br><span class="line">filter: b1</span><br><span class="line">forEach: b1</span><br><span class="line">filter: b3</span><br><span class="line">forEach: b3</span><br><span class="line">filter: c</span><br><span class="line">forEach: c</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>
<p>이 코드 스니펫을 실행하면 콘솔에 원하는 결과가 나타납니다.</p>
<p>결과의 순서는 놀랄 수 있습니다.<br>순진한 방법은 스트림의 모든 요소에 대해 수평 적으로 연산을 차례대로 실행하는 것입니다.<br>그러나 대신 각 요소는 체인을 따라 세로로 이동합니다.<br>첫번째 문자열 “D2”는 전달 filter후 forEach 그래야만 두번째 문자열 “A2”가 처리된다.</p>
<p>이 동작은 다음 예제에서 볼 수 있듯이 각 요소에서 수행 된 실제 작업 수를 줄일 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProcessingOrder</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Stream.of(<span class="string">&quot;d2&quot;</span>, <span class="string">&quot;a2&quot;</span>, <span class="string">&quot;b1&quot;</span>, <span class="string">&quot;b3&quot;</span>, <span class="string">&quot;c&quot;</span>)</span><br><span class="line">                .map(s -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;map: &quot;</span> + s);</span><br><span class="line">                    <span class="keyword">return</span> s.toUpperCase();</span><br><span class="line">                &#125;)</span><br><span class="line">                .anyMatch(s -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;anyMatch: &quot;</span> + s);</span><br><span class="line">                    <span class="keyword">return</span> s.startsWith(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">map: d2</span><br><span class="line">anyMatch: D2</span><br><span class="line">map: a2</span><br><span class="line">anyMatch: A2</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>
<p>술어가 주어진 입력 요소에 적용되는 즉시 조작이 anyMatch리턴 true됩니다.<br>이것은 “A2”가 전달 된 두 번째 요소에 해당됩니다.<br>스트림 체인의 수직 실행 map때문에이 경우에는 두 번만 실행하면됩니다.<br>따라서 스트림의 모든 요소를 매핑하는 대신 map가능하면 적게 호출됩니다.</p>
<h5 id="주문-문제가있는-이유"><a href="#주문-문제가있는-이유" class="headerlink" title="주문 문제가있는 이유"></a>주문 문제가있는 이유</h5><p>다음 예제는 두 개의 중간 작업 map및 filter터미널 작업으로 구성 forEach됩니다.<br>이러한 작업이 어떻게 실행되고 있는지 다시 한번 살펴 보겠습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WhyOrderMatters</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Stream.of(<span class="string">&quot;d2&quot;</span>, <span class="string">&quot;a2&quot;</span>, <span class="string">&quot;b1&quot;</span>, <span class="string">&quot;b3&quot;</span>, <span class="string">&quot;c&quot;</span>)</span><br><span class="line">                .map(s -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;map: &quot;</span> + s);</span><br><span class="line">                    <span class="keyword">return</span> s.toUpperCase();</span><br><span class="line">                &#125;)</span><br><span class="line">                .filter(s -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;filter: &quot;</span> + s);</span><br><span class="line">                    <span class="keyword">return</span> s.startsWith(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">                &#125;)</span><br><span class="line">                .forEach(s -&gt; System.out.println(<span class="string">&quot;forEach: &quot;</span> + s));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">map: d2</span><br><span class="line">filter: D2</span><br><span class="line">map: a2</span><br><span class="line">filter: A2</span><br><span class="line">forEach: A2</span><br><span class="line">map: b1</span><br><span class="line">filter: B1</span><br><span class="line">map: b3</span><br><span class="line">filter: B3</span><br><span class="line">map: c</span><br><span class="line">filter: C</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>당신은 둘 다 짐작으로 map하고 filter반면에 기본 컬렉션의 모든 문자열을 다섯 번이라고<br>forEach 한 번만 호출된다고 생각했다 하지만 결과는 아니다.</p>
<p>filter체인의 시작 부분으로 이동하여 작업 순서를 변경하면 실제 실행 횟수를 크게 줄일 수 있습니다 .</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WhyOrderMatters</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Stream.of(<span class="string">&quot;d2&quot;</span>, <span class="string">&quot;a2&quot;</span>, <span class="string">&quot;b1&quot;</span>, <span class="string">&quot;b3&quot;</span>, <span class="string">&quot;c&quot;</span>)</span><br><span class="line">                .filter(s -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;filter: &quot;</span> + s);</span><br><span class="line">                    <span class="keyword">return</span> s.startsWith(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">                &#125;)</span><br><span class="line">                .map(s -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;map: &quot;</span> + s);</span><br><span class="line">                    <span class="keyword">return</span> s.toUpperCase();</span><br><span class="line">                &#125;)</span><br><span class="line">                .forEach(s -&gt; System.out.println(<span class="string">&quot;forEach: &quot;</span> + s));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">filter: d2</span><br><span class="line">filter: a2</span><br><span class="line">map: a2</span><br><span class="line">forEach: A2</span><br><span class="line">filter: b1</span><br><span class="line">filter: b3</span><br><span class="line">filter: c</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>이제는 map한 번만 호출되므로 많은 수의 입력 요소에 대해 작업 파이프 라인이 훨씬 빠르게 수행됩니다. 복잡한 메소드 체인을 작성할 때이를 명심하십시오.</p>
<p>위의 예제를 추가 작업으로 확장 해 보겠습니다 sorted.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WhyOrderMatters</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        Stream.of(<span class="string">&quot;d2&quot;</span>, <span class="string">&quot;a2&quot;</span>, <span class="string">&quot;a1&quot;</span>, <span class="string">&quot;b1&quot;</span>, <span class="string">&quot;b3&quot;</span>, <span class="string">&quot;c&quot;</span>)</span><br><span class="line">                .sorted((s1, s2) -&gt; &#123;</span><br><span class="line">                    System.out.printf(<span class="string">&quot;sort: %s; %s\n&quot;</span>, s1, s2);</span><br><span class="line">                    <span class="keyword">return</span> s1.compareTo(s2);</span><br><span class="line">                &#125;)</span><br><span class="line">                .filter(s -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;filter: &quot;</span> + s);</span><br><span class="line">                    <span class="keyword">return</span> s.startsWith(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">                &#125;)</span><br><span class="line">                .map(s -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;map: &quot;</span> + s);</span><br><span class="line">                    <span class="keyword">return</span> s.toUpperCase();</span><br><span class="line">                &#125;)</span><br><span class="line">                .forEach(s -&gt; System.out.println(<span class="string">&quot;forEach: &quot;</span> + s));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>정렬은 특별한 종류의 중간 작업입니다. 이것은 소위 스테이트 풀(stateful) 연산 입니다.<br>요소 모음을 정렬하기 위해 주문하는 동안 상태를 유지해야하기 때문입니다.</p>
<p>이 예제를 실행하면 다음 콘솔 출력이됩니다.</p>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">sort: a2; d2</span><br><span class="line">sort: a1; a2</span><br><span class="line">sort: b1; a1</span><br><span class="line">sort: b1; a2</span><br><span class="line">sort: b1; d2</span><br><span class="line">sort: b3; b1</span><br><span class="line">sort: b3; d2</span><br><span class="line">sort: c; b1</span><br><span class="line">sort: c; d2</span><br><span class="line">sort: c; b3</span><br><span class="line">filter: a1</span><br><span class="line">map: a1</span><br><span class="line">forEach: A1</span><br><span class="line">filter: a2</span><br><span class="line">map: a2</span><br><span class="line">forEach: A2</span><br><span class="line">filter: b1</span><br><span class="line">filter: b3</span><br><span class="line">filter: c</span><br><span class="line">filter: d2</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>먼저 정렬 작업이 전체 입력 컬렉션에 대해 실행됩니다. 즉, sorted가로로 실행됩니다.<br>따라서이 경우 sorted입력 컬렉션의 모든 요소에서 여러 조합에 대해 8 번 호출됩니다.</p>
<p>체인의 순서를 다시 지정하여 성능을 최적화 할 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WhyOrderMatters</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       </span><br><span class="line">        Stream.of(<span class="string">&quot;d2&quot;</span>, <span class="string">&quot;a2&quot;</span>, <span class="string">&quot;b1&quot;</span>, <span class="string">&quot;b3&quot;</span>, <span class="string">&quot;c&quot;</span>)</span><br><span class="line">                .filter(s -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;filter: &quot;</span> + s);</span><br><span class="line">                    <span class="keyword">return</span> s.startsWith(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">                &#125;)</span><br><span class="line">                .sorted((s1, s2) -&gt; &#123;</span><br><span class="line">                    System.out.printf(<span class="string">&quot;sort: %s; %s\n&quot;</span>, s1, s2);</span><br><span class="line">                    <span class="keyword">return</span> s1.compareTo(s2);</span><br><span class="line">                &#125;)</span><br><span class="line">                .map(s -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;map: &quot;</span> + s);</span><br><span class="line">                    <span class="keyword">return</span> s.toUpperCase();</span><br><span class="line">                &#125;)</span><br><span class="line">                .forEach(s -&gt; System.out.println(<span class="string">&quot;forEach: &quot;</span> + s));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">filter: d2</span><br><span class="line">filter: a2</span><br><span class="line">filter: b1</span><br><span class="line">filter: b3</span><br><span class="line">filter: c</span><br><span class="line">map: a2</span><br><span class="line">forEach: A2</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>
<p>이 예제에서는 filter로 입력 컬렉션을 하나의 요소로만 줄일 수 sorted있기 때문에 호출 된 적이 없다 .<br>따라서 더 큰 입력 컬렉션의 경우 성능이 크게 향상됩니다.</p>
<h4 id="스트림-재사용"><a href="#스트림-재사용" class="headerlink" title="스트림 재사용"></a>스트림 재사용</h4><p>Java 8 스트림은 재사용 할 수 없습니다. 터미널 작업을 호출하자마자 스트림이 닫힙니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReusingStreams</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Stream&lt;String&gt; stream =</span><br><span class="line">                Stream.of(<span class="string">&quot;d2&quot;</span>, <span class="string">&quot;a2&quot;</span>, <span class="string">&quot;b1&quot;</span>, <span class="string">&quot;b3&quot;</span>, <span class="string">&quot;c&quot;</span>)</span><br><span class="line">                        .filter(s -&gt; s.startsWith(<span class="string">&quot;a&quot;</span>));</span><br><span class="line"></span><br><span class="line">        stream.anyMatch(s -&gt; <span class="literal">true</span>);    <span class="comment">// ok</span></span><br><span class="line">        stream.noneMatch(s -&gt; <span class="literal">true</span>);   <span class="comment">// exception</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>호출 noneMatch후 anyMatch다음과 같은 예외가 동일한 스트림 결과 :</p>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.lang.IllegalStateException: stream has already been operated upon or closed</span><br><span class="line">	at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:229)</span><br><span class="line">	at java.base/java.util.stream.ReferencePipeline.noneMatch(ReferencePipeline.java:538)</span><br><span class="line">	at com.github.sejoung.codetest.stream.ReusingStreams.main(ReusingStreams.java:12)</span><br><span class="line"></span><br><span class="line">Process finished with exit code 1</span><br></pre></td></tr></table></figure>

<p>이 제한을 극복하기 위해, 우리는 실행하고자하는 모든 터미널 작업에 대해 새로운 스트림 체인을 생성해야합니다.<br>예를 들어, 모든 중간 작업이 이미 설정된 상태에서 새로운 스트림을 생성하기 위해 스트림 공급 업체를 생성 할 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.function.Supplier;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReusingStreams</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Supplier&lt;Stream&lt;String&gt;&gt; streamSupplier =</span><br><span class="line">                () -&gt; Stream.of(<span class="string">&quot;d2&quot;</span>, <span class="string">&quot;a2&quot;</span>, <span class="string">&quot;b1&quot;</span>, <span class="string">&quot;b3&quot;</span>, <span class="string">&quot;c&quot;</span>)</span><br><span class="line">                        .filter(s -&gt; s.startsWith(<span class="string">&quot;a&quot;</span>));</span><br><span class="line"></span><br><span class="line">        streamSupplier.get().anyMatch(s -&gt; <span class="literal">true</span>);   <span class="comment">// ok</span></span><br><span class="line">        streamSupplier.get().noneMatch(s -&gt; <span class="literal">true</span>);  <span class="comment">// ok</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>
<p>각 호출 get()은 원하는 터미널 작업을 호출하기 위해 저장되는 새 스트림 을 생성합니다.</p>
<h4 id="고급-작업"><a href="#고급-작업" class="headerlink" title="고급 작업"></a>고급 작업</h4><p>스트림은 다양한 작업을 지원합니다.<br>우리는 이미 같은 가장 중요한 작업에 대해 배운 filter나 map.<br>사용 가능한 다른 모든 연산을 발견하기 위해 여러분에게 맡깁니다 ( Stream Javadoc 참고 ).<br>대신 이제 더 복잡한 작업으로 깊은 다이빙을하자 collect, flatMap하고 reduce.</p>
<p>이 섹션의 대부분의 코드 샘플은 데모 목적으로 다음 사람 목록을 사용합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    Person(String name, <span class="type">int</span> age) &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdvancedOperations</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Person&gt; persons =</span><br><span class="line">                Arrays.asList(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Max&quot;</span>, <span class="number">18</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Peter&quot;</span>, <span class="number">23</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Pamela&quot;</span>, <span class="number">23</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;David&quot;</span>, <span class="number">12</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="Collect"><a href="#Collect" class="headerlink" title="Collect"></a>Collect</h5><p>수집은 다른 결과의 종류, 예로 스트림의 변환 소자를 위해 매우 유용하다 단말기 동작 List, Set또는 Map. 수집 (Collect)은 공급 업체 , 누적 기 , 결합기 및 피니셔Collector 의 네 가지 작업으로 구성된 a 를 수용합니다 . 이것은 처음에는 매우 복잡해 보이지만, Java 8은 클래스 를 통해 다양한 내장 콜렉터를 지원합니다 . 따라서 가장 일반적인 작업의 경우 수집기를 직접 구현할 필요가 없습니다.Collectors</p>
<p>매우 일반적인 유즈 케이스부터 시작합시다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdvancedOperations</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Person&gt; persons =</span><br><span class="line">                Arrays.asList(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Max&quot;</span>, <span class="number">18</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Peter&quot;</span>, <span class="number">23</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Pamela&quot;</span>, <span class="number">23</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;David&quot;</span>, <span class="number">12</span>));</span><br><span class="line"></span><br><span class="line">        List&lt;Person&gt; filtered =</span><br><span class="line">                persons</span><br><span class="line">                        .stream()</span><br><span class="line">                        .filter(p -&gt; p.name.startsWith(<span class="string">&quot;P&quot;</span>))</span><br><span class="line">                        .collect(Collectors.toList());</span><br><span class="line">        System.out.println(filtered);    <span class="comment">// [Peter, Pamela]</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Peter, Pamela]</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>보시다시피 스트림 요소에서 List을 만드는 것은 매우 간단합니다.<br>List 대신 Set이 필요합니다 Collectors.toSet(). 사용하십시오 .</p>
<p>다음 예는 모든 사람을 나이별로 분류합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdvancedOperations</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Person&gt; persons =</span><br><span class="line">                Arrays.asList(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Max&quot;</span>, <span class="number">18</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Peter&quot;</span>, <span class="number">23</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Pamela&quot;</span>, <span class="number">23</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;David&quot;</span>, <span class="number">12</span>));</span><br><span class="line"></span><br><span class="line">        Map&lt;Integer, List&lt;Person&gt;&gt; personsByAge = persons</span><br><span class="line">                .stream()</span><br><span class="line">                .collect(Collectors.groupingBy(p -&gt; p.age));</span><br><span class="line"></span><br><span class="line">        personsByAge</span><br><span class="line">                .forEach((age, p) -&gt; System.out.format(<span class="string">&quot;age %s: %s\n&quot;</span>, age, p));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">age 18: [Max]</span><br><span class="line">age 23: [Peter, Pamela]</span><br><span class="line">age 12: [David]</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>컬렉터는 매우 다목적입니다. </p>
<p>스트림의 요소에 대한 집계를 만들 수도 있습니다 (예 : 모든 사람의 평균 연령).</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdvancedOperations</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Person&gt; persons =</span><br><span class="line">                Arrays.asList(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Max&quot;</span>, <span class="number">18</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Peter&quot;</span>, <span class="number">23</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Pamela&quot;</span>, <span class="number">23</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;David&quot;</span>, <span class="number">12</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">Double</span> <span class="variable">averageAge</span> <span class="operator">=</span> persons</span><br><span class="line">                .stream()</span><br><span class="line">                .collect(Collectors.averagingInt(p -&gt; p.age));</span><br><span class="line"></span><br><span class="line">        System.out.println(averageAge);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">19.0</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>보다 포괄적 인 통계에 관심이 있다면, 요약 콜렉터는 특수 내장 기본 통계 오브젝트를 리턴합니다.<br>따라서 우리는 단순히 사람의 최소 , 최대 및 산술 평균 연령뿐만 아니라 합계 및 수를 결정할 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.IntSummaryStatistics;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdvancedOperations</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Person&gt; persons =</span><br><span class="line">                Arrays.asList(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Max&quot;</span>, <span class="number">18</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Peter&quot;</span>, <span class="number">23</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Pamela&quot;</span>, <span class="number">23</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;David&quot;</span>, <span class="number">12</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">IntSummaryStatistics</span> <span class="variable">ageSummary</span> <span class="operator">=</span></span><br><span class="line">                persons</span><br><span class="line">                        .stream()</span><br><span class="line">                        .collect(Collectors.summarizingInt(p -&gt; p.age));</span><br><span class="line"></span><br><span class="line">        System.out.println(ageSummary);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">IntSummaryStatistics&#123;count=4, sum=76, min=12, average=19.000000, max=23&#125;</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>다음 예는 모든 사람을 단일 문자열로 결합합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.IntSummaryStatistics;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdvancedOperations</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Person&gt; persons =</span><br><span class="line">                Arrays.asList(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Max&quot;</span>, <span class="number">18</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Peter&quot;</span>, <span class="number">23</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Pamela&quot;</span>, <span class="number">23</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;David&quot;</span>, <span class="number">12</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">phrase</span> <span class="operator">=</span> persons</span><br><span class="line">                .stream()</span><br><span class="line">                .filter(p -&gt; p.age &gt;= <span class="number">18</span>)</span><br><span class="line">                .map(p -&gt; p.name)</span><br><span class="line">                .collect(Collectors.joining(<span class="string">&quot; and &quot;</span>, <span class="string">&quot;In Germany &quot;</span>, <span class="string">&quot; are of legal age.&quot;</span>));</span><br><span class="line"></span><br><span class="line">        System.out.println(phrase);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In Germany Max and Peter and Pamela are of legal age.</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>조인 콜렉터는 선택적 접두어 및 접미어와 구분 기호를 허용합니다.</p>
<p>스트림 요소를지도로 변환하려면 키와 값을 매핑하는 방법을 지정해야합니다.<br>매핑 된 키는 고유해야하며 그렇지 않으면 an IllegalStateException이 Throw됩니다.<br>선택적으로 병합 함수를 추가 매개 변수로 전달하여 예외를 무시할 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.IntSummaryStatistics;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdvancedOperations</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Person&gt; persons =</span><br><span class="line">                Arrays.asList(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Max&quot;</span>, <span class="number">18</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Peter&quot;</span>, <span class="number">23</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Pamela&quot;</span>, <span class="number">23</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;David&quot;</span>, <span class="number">12</span>));</span><br><span class="line"></span><br><span class="line">        Map&lt;Integer, String&gt; map = persons</span><br><span class="line">                .stream()</span><br><span class="line">                .collect(Collectors.toMap(</span><br><span class="line">                        p -&gt; p.age,</span><br><span class="line">                        p -&gt; p.name,</span><br><span class="line">                        (name1, name2) -&gt; name1 + <span class="string">&quot;;&quot;</span> + name2));</span><br><span class="line"></span><br><span class="line">        System.out.println(map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;18=Max, 23=Peter;Pamela, 12=David&#125;</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>이제 가장 강력한 빌트인 콜렉터 중 일부를 알았으니 이제는 자체 콜렉터를 만들자.<br>우리는 스트림의 모든 사람을 |파이프 문자 로 구분 된 상위 문자로 된 모든 이름으로 구성된 단일 문자열로 변환하려고합니다 .<br>이것을 달성하기 위해 우리는 새로운 컬렉터를 통해 만듭니다 Collector.of().<br>우리는 수집가의 4 가지 성분 , 즉 공급자 , 축 압기 , 결합기 및 피니셔 를 통과해야합니다 .</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collector;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdvancedOperations</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Person&gt; persons =</span><br><span class="line">                Arrays.asList(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Max&quot;</span>, <span class="number">18</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Peter&quot;</span>, <span class="number">23</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Pamela&quot;</span>, <span class="number">23</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;David&quot;</span>, <span class="number">12</span>));</span><br><span class="line"></span><br><span class="line">        Collector&lt;Person, StringJoiner, String&gt; personNameCollector =</span><br><span class="line">                Collector.of(</span><br><span class="line">                        () -&gt; <span class="keyword">new</span> <span class="title class_">StringJoiner</span>(<span class="string">&quot; | &quot;</span>),          <span class="comment">// supplier</span></span><br><span class="line">                        (j, p) -&gt; j.add(p.name.toUpperCase()),  <span class="comment">// accumulator</span></span><br><span class="line">                        (j1, j2) -&gt; j1.merge(j2),               <span class="comment">// combiner</span></span><br><span class="line">                        StringJoiner::toString);                <span class="comment">// finisher</span></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">names</span> <span class="operator">=</span> persons</span><br><span class="line">                .stream()</span><br><span class="line">                .collect(personNameCollector);</span><br><span class="line"></span><br><span class="line">        System.out.println(names);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MAX | PETER | PAMELA | DAVID</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>
<p>Java의 문자열은 불변이므로 StringJoiner 콜렉터가 문자열을 생성하도록 하는 헬퍼 클래스가 필요 합니다.<br>공급자(supplier)는 초기에 적절한 구분 기호로 이러한 StringJoiner를 생성합니다.<br>누적기(accumulator)는 StringJoiner에 각 사람 대문자 이름을 추가하는 데 사용됩니다.<br>결합 자 (combiner)는 두 개의 StringJoiners를 하나로 병합하는 방법을 알고 있습니다.<br>마지막 단계에서 finisher는 StringJoiner에서 원하는 String을 생성합니다.</p>
<h5 id="FlatMap"><a href="#FlatMap" class="headerlink" title="FlatMap"></a>FlatMap</h5><p>우리는 이미 map작업 을 활용하여 스트림의 객체를 다른 유형의 객체로 변환하는 방법을 배웠습니다 .<br>모든 객체는 정확히 하나의 다른 객체에만 매핑 될 수 있기 때문에지도가 다소 제한적입니다.<br>그러나 하나의 객체를 여러 객체로 변환하거나 전혀 변환하지 않으려면 어떻게해야할까요?<br>이것은 flatMap구출에 관해서입니다.</p>
<p>FlatMap은 스트림의 각 요소를 다른 오브젝트의 스트림으로 변환합니다.<br>따라서 각 객체는 스트림에 의해 지원되는 0, 하나 또는 여러 개의 다른 객체로 변환됩니다.<br>이러한 스트림의 내용은 반환 된 flatMap작업 스트림에 배치됩니다 .</p>
<p>flatMap실제로 작동 하기 전에 적절한 유형 계층 구조가 필요합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bar</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line"></span><br><span class="line">    Bar(String name) &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Foo</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    List&lt;Bar&gt; bars = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    Foo(String name) &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>다음으로 스트림에 대한 지식을 활용하여 몇 가지 객체를 인스턴스화합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.IntStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlatMapTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Foo&gt; foos = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// create foos</span></span><br><span class="line">        IntStream</span><br><span class="line">                .range(<span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">                .forEach(i -&gt; foos.add(<span class="keyword">new</span> <span class="title class_">Foo</span>(<span class="string">&quot;Foo&quot;</span> + i)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// create bars</span></span><br><span class="line">        foos.forEach(f -&gt;</span><br><span class="line">                IntStream</span><br><span class="line">                        .range(<span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">                        .forEach(i -&gt; f.bars.add(<span class="keyword">new</span> <span class="title class_">Bar</span>(<span class="string">&quot;Bar&quot;</span> + i + <span class="string">&quot; &lt;- &quot;</span> + f.name))));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>이제 우리는 3 개의 막대로 구성된 목록을 각각 3 개의 막대로 구성했습니다.</p>
<p>FlatMap은 객체 스트림을 반환해야하는 함수를 허용합니다. 따라서 각 foo의 bar 객체를 해결하기 위해 적절한 함수를 전달합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.IntStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlatMapTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Foo&gt; foos = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// create foos</span></span><br><span class="line">        IntStream</span><br><span class="line">                .range(<span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">                .forEach(i -&gt; foos.add(<span class="keyword">new</span> <span class="title class_">Foo</span>(<span class="string">&quot;Foo&quot;</span> + i)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// create bars</span></span><br><span class="line">        foos.forEach(f -&gt;</span><br><span class="line">                IntStream</span><br><span class="line">                        .range(<span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">                        .forEach(i -&gt; f.bars.add(<span class="keyword">new</span> <span class="title class_">Bar</span>(<span class="string">&quot;Bar&quot;</span> + i + <span class="string">&quot; &lt;- &quot;</span> + f.name))));</span><br><span class="line"></span><br><span class="line">        foos.stream()</span><br><span class="line">                .flatMap(f -&gt; f.bars.stream())</span><br><span class="line">                .forEach(b -&gt; System.out.println(b.name));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Bar1 &lt;- Foo1</span><br><span class="line">Bar2 &lt;- Foo1</span><br><span class="line">Bar3 &lt;- Foo1</span><br><span class="line">Bar1 &lt;- Foo2</span><br><span class="line">Bar2 &lt;- Foo2</span><br><span class="line">Bar3 &lt;- Foo2</span><br><span class="line">Bar1 &lt;- Foo3</span><br><span class="line">Bar2 &lt;- Foo3</span><br><span class="line">Bar3 &lt;- Foo3</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>
<p>보시다시피, 우리는 성공적으로 3 개의 foo 객체의 스트림을 9 개의 막대 객체의 스트림으로 변환했습니다.</p>
<p>마지막으로 위의 코드 예제를 스트림 작업의 단일 파이프 라인으로 단순화 할 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.IntStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlatMapTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        IntStream.range(<span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">                .mapToObj(i -&gt; <span class="keyword">new</span> <span class="title class_">Foo</span>(<span class="string">&quot;Foo&quot;</span> + i))</span><br><span class="line">                .peek(f -&gt; IntStream.range(<span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">                        .mapToObj(i -&gt; <span class="keyword">new</span> <span class="title class_">Bar</span>(<span class="string">&quot;Bar&quot;</span> + i + <span class="string">&quot; &lt;- &quot;</span> + f.name))</span><br><span class="line">                        .forEach(f.bars::add))</span><br><span class="line">                .flatMap(f -&gt; f.bars.stream())</span><br><span class="line">                .forEach(b -&gt; System.out.println(b.name));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Bar1 &lt;- Foo1</span><br><span class="line">Bar2 &lt;- Foo1</span><br><span class="line">Bar3 &lt;- Foo1</span><br><span class="line">Bar1 &lt;- Foo2</span><br><span class="line">Bar2 &lt;- Foo2</span><br><span class="line">Bar3 &lt;- Foo2</span><br><span class="line">Bar1 &lt;- Foo3</span><br><span class="line">Bar2 &lt;- Foo3</span><br><span class="line">Bar3 &lt;- Foo3</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>
<p>FlatMap은 OptionalJava 8에 도입 된 클래스 에서도 사용할 수 있습니다.<br>옵션 flatMap연산은 다른 유형의 선택적 객체를 반환합니다.<br>따라서 불쾌한 null검사 를 방지하기 위해 활용할 수 있습니다 .</p>
<p>다음과 같이 고도로 계층화 된 구조를 생각해보십시오.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Outer</span> &#123;</span><br><span class="line">    Nested nested;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Nested</span> &#123;</span><br><span class="line">    Inner inner;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Inner</span> &#123;</span><br><span class="line">    String foo;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>foo외부 인스턴스 의 내부 문자열을 해결하려면 NullPointerExceptions을 방지하기 위해 여러 개의 null 검사를 추가해야합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NestedTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Outer</span> <span class="variable">outer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Outer</span>();</span><br><span class="line">        <span class="keyword">if</span> (outer != <span class="literal">null</span> &amp;&amp; outer.nested != <span class="literal">null</span> &amp;&amp; outer.nested.inner != <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(outer.nested.inner.foo);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>optionals flatMap연산 을 사용하여 동일한 동작을 얻을 수 있습니다 .</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NestedTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        Optional.of(<span class="keyword">new</span> <span class="title class_">Outer</span>())</span><br><span class="line">                .flatMap(o -&gt; Optional.ofNullable(o.nested))</span><br><span class="line">                .flatMap(n -&gt; Optional.ofNullable(n.inner))</span><br><span class="line">                .flatMap(i -&gt; Optional.ofNullable(i.foo))</span><br><span class="line">                .ifPresent(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>각 호출 flatMap다시 표시 Optional포장 존재하는 경우 또는 원하는 개체 null없는 경우.</p>
<h5 id="Reduce"><a href="#Reduce" class="headerlink" title="Reduce"></a>Reduce</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReduceTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Person&gt; persons =</span><br><span class="line">                Arrays.asList(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Max&quot;</span>, <span class="number">18</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Peter&quot;</span>, <span class="number">23</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Pamela&quot;</span>, <span class="number">23</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;David&quot;</span>, <span class="number">12</span>));</span><br><span class="line"></span><br><span class="line">        persons</span><br><span class="line">                .stream()</span><br><span class="line">                .reduce((p1, p2) -&gt; p1.age &gt; p2.age ? p1 : p2)</span><br><span class="line">                .ifPresent(System.out::println);    <span class="comment">// Pamela</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Pamela</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>이 reduce메서드는 BinaryOperator 누산기 함수를 허용 합니다.<br>이 경우 실제로 BiFunction두 피연산자가 같은 유형을 공유합니다 Person. BiFunction은 비슷 Function하지만 두 가지 인수를 허용합니다.<br>예제 함수는 두 사람의 나이를 비교하여 최대 연령의 사람을 반환합니다.</p>
<p>두 번째 reduce방법은 신원 값과 BinaryOperator누적 기를 모두 허용합니다.<br>이 메소드는 스트림의 다른 모든 사람들로부터 집합 된 이름과 나이를 가진 새로운 Person을 생성하는 데 사용할 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReduceTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Person&gt; persons =</span><br><span class="line">                Arrays.asList(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Max&quot;</span>, <span class="number">18</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Peter&quot;</span>, <span class="number">23</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Pamela&quot;</span>, <span class="number">23</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;David&quot;</span>, <span class="number">12</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">Person</span> <span class="variable">result</span> <span class="operator">=</span></span><br><span class="line">                persons</span><br><span class="line">                        .stream()</span><br><span class="line">                        .reduce(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;&quot;</span>, <span class="number">0</span>), (p1, p2) -&gt; &#123;</span><br><span class="line">                            p1.age += p2.age;</span><br><span class="line">                            p1.name += p2.name;</span><br><span class="line">                            <span class="keyword">return</span> p1;</span><br><span class="line">                        &#125;);</span><br><span class="line"></span><br><span class="line">        System.out.format(<span class="string">&quot;name=%s; age=%s&quot;</span>, result.name, result.age);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name=MaxPeterPamelaDavid; age=76</span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>
<p>세 번째 reduce방법은 신원 값, BiFunction누적 기 및 유형의 결합 함수의 세 가지 매개 변수를 허용 합니다 BinaryOperator.<br>신원 값 유형은 유형에만 국한되지 않으므로이 Person감소를 활용하여 모든 사람의 연령 합계를 결정할 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReduceTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Person&gt; persons =</span><br><span class="line">                Arrays.asList(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Max&quot;</span>, <span class="number">18</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Peter&quot;</span>, <span class="number">23</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Pamela&quot;</span>, <span class="number">23</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;David&quot;</span>, <span class="number">12</span>));</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">ageSum</span> <span class="operator">=</span> persons</span><br><span class="line">                .stream()</span><br><span class="line">                .reduce(<span class="number">0</span>, (sum, p) -&gt; sum += p.age, (sum1, sum2) -&gt; sum1 + sum2);</span><br><span class="line"></span><br><span class="line">        System.out.println(ageSum);  <span class="comment">// 76</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">76</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>보시다시피 결과는 76 이지만 정확히 어떤 일이 일어나고 있습니까?<br>위의 코드를 일부 디버그 출력으로 확장 해 봅시다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReduceTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Person&gt; persons =</span><br><span class="line">                Arrays.asList(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Max&quot;</span>, <span class="number">18</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Peter&quot;</span>, <span class="number">23</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Pamela&quot;</span>, <span class="number">23</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;David&quot;</span>, <span class="number">12</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">ageSum</span> <span class="operator">=</span> persons</span><br><span class="line">                .stream()</span><br><span class="line">                .reduce(<span class="number">0</span>,</span><br><span class="line">                        (sum, p) -&gt; &#123;</span><br><span class="line">                            System.out.format(<span class="string">&quot;accumulator: sum=%s; person=%s\n&quot;</span>, sum, p);</span><br><span class="line">                            <span class="keyword">return</span> sum += p.age;</span><br><span class="line">                        &#125;,</span><br><span class="line">                        (sum1, sum2) -&gt; &#123;</span><br><span class="line">                            System.out.format(<span class="string">&quot;combiner: sum1=%s; sum2=%s\n&quot;</span>, sum1, sum2);</span><br><span class="line">                            <span class="keyword">return</span> sum1 + sum2;</span><br><span class="line">                        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">accumulator: sum=0; person=Max</span><br><span class="line">accumulator: sum=18; person=Peter</span><br><span class="line">accumulator: sum=41; person=Pamela</span><br><span class="line">accumulator: sum=64; person=David</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>보시다시피 accumulator 함수가 모든 작업을 수행합니다. 처음에는 초기 신원 값 0 과 첫 번째 사람 Max로 호출됩니다 . 다음 3 단계 sum에서는 마지막 단계 인력의 나이까지 76 세까지 지속적으로 증가합니다 .</p>
<p>와트, 기다려? 결합자는 결코 불리지 않는다? 동일한 스트림을 병렬로 실행하면 비밀이 해제됩니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReduceTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Person&gt; persons =</span><br><span class="line">                Arrays.asList(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Max&quot;</span>, <span class="number">18</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Peter&quot;</span>, <span class="number">23</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Pamela&quot;</span>, <span class="number">23</span>),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;David&quot;</span>, <span class="number">12</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">ageSum</span> <span class="operator">=</span> persons</span><br><span class="line">                .parallelStream()</span><br><span class="line">                .reduce(<span class="number">0</span>,</span><br><span class="line">                        (sum, p) -&gt; &#123;</span><br><span class="line">                            System.out.format(<span class="string">&quot;accumulator: sum=%s; person=%s\n&quot;</span>, sum, p);</span><br><span class="line">                            <span class="keyword">return</span> sum += p.age;</span><br><span class="line">                        &#125;,</span><br><span class="line">                        (sum1, sum2) -&gt; &#123;</span><br><span class="line">                            System.out.format(<span class="string">&quot;combiner: sum1=%s; sum2=%s\n&quot;</span>, sum1, sum2);</span><br><span class="line">                            <span class="keyword">return</span> sum1 + sum2;</span><br><span class="line">                        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">accumulator: sum=0; person=Pamela</span><br><span class="line">accumulator: sum=0; person=Max</span><br><span class="line">accumulator: sum=0; person=Peter</span><br><span class="line">combiner: sum1=18; sum2=23</span><br><span class="line">accumulator: sum=0; person=David</span><br><span class="line">combiner: sum1=23; sum2=12</span><br><span class="line">combiner: sum1=41; sum2=35</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>
<p>이 스트림을 병렬로 실행하면 완전히 다른 실행 동작이 발생합니다. 이제 결합자는 실제로 호출됩니다. 누산기가 병렬로 호출되기 때문에, 결합기는 별도의 누적 값을 합산하는 데 필요합니다.</p>
<p>다음 장에서 병렬 스트림에 대해 자세히 살펴 봅시다.</p>
<h4 id="병렬-스트림"><a href="#병렬-스트림" class="headerlink" title="병렬 스트림"></a>병렬 스트림</h4><p>스트림을 병렬로 실행하여 많은 양의 입력 요소에서 런타임 성능을 향상시킬 수 있습니다.<br>병렬 스트림 ForkJoinPool은 정적 ForkJoinPool.commonPool()메서드 를 통해 사용할 수 있는 공용 객체를 사용합니다 .<br>기본 스레드 풀의 크기는 사용 가능한 실제 CPU 코어의 양에 따라 최대 5 개의 스레드를 사용합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ForkJoinPool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ParallelStream</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ForkJoinPool</span> <span class="variable">commonPool</span> <span class="operator">=</span> ForkJoinPool.commonPool();</span><br><span class="line">        System.out.println(commonPool.getParallelism());    <span class="comment">// 3</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>
<p>내 컴퓨터에서 공통 풀은 기본값 당 3의 병렬 처리로 초기화됩니다. 이 값은 다음 JVM 매개 변수를 설정하여 줄이거 나 늘릴 수 있습니다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-Djava.util.concurrent.ForkJoinPool.common.parallelism=5</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>컬렉션 parallelStream()은 요소의 병렬 스트림을 만드는 방법 을 지원합니다 . 또는 parallel()주어진 스트림 에서 intermediate 메소드 를 호출하여 순차 스트림을 병렬 스트림으로 변환 할 수 있습니다 .</p>
<p>병렬 스트림의 병렬 실행 동작을 줄이기 위해 다음 예제는 현재 스레드에 대한 정보를 다음에 인쇄합니다 sout</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ForkJoinPool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ParallelStream</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Arrays.asList(<span class="string">&quot;a1&quot;</span>, <span class="string">&quot;a2&quot;</span>, <span class="string">&quot;b1&quot;</span>, <span class="string">&quot;c2&quot;</span>, <span class="string">&quot;c1&quot;</span>)</span><br><span class="line">                .parallelStream()</span><br><span class="line">                .filter(s -&gt; &#123;</span><br><span class="line">                    System.out.format(<span class="string">&quot;filter: %s [%s]\n&quot;</span>,</span><br><span class="line">                            s, Thread.currentThread().getName());</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;)</span><br><span class="line">                .map(s -&gt; &#123;</span><br><span class="line">                    System.out.format(<span class="string">&quot;map: %s [%s]\n&quot;</span>,</span><br><span class="line">                            s, Thread.currentThread().getName());</span><br><span class="line">                    <span class="keyword">return</span> s.toUpperCase();</span><br><span class="line">                &#125;)</span><br><span class="line">                .forEach(s -&gt; System.out.format(<span class="string">&quot;forEach: %s [%s]\n&quot;</span>,</span><br><span class="line">                        s, Thread.currentThread().getName()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>디버그 출력을 조사하여 스트림 작업을 실행하는 데 실제로 사용되는 스레드를 더 잘 이해해야합니다.</p>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">filter: b1 [main]</span><br><span class="line">filter: c2 [ForkJoinPool.commonPool-worker-7]</span><br><span class="line">map: c2 [ForkJoinPool.commonPool-worker-7]</span><br><span class="line">forEach: C2 [ForkJoinPool.commonPool-worker-7]</span><br><span class="line">filter: c1 [ForkJoinPool.commonPool-worker-3]</span><br><span class="line">map: c1 [ForkJoinPool.commonPool-worker-3]</span><br><span class="line">filter: a2 [ForkJoinPool.commonPool-worker-5]</span><br><span class="line">map: a2 [ForkJoinPool.commonPool-worker-5]</span><br><span class="line">forEach: C1 [ForkJoinPool.commonPool-worker-3]</span><br><span class="line">filter: a1 [ForkJoinPool.commonPool-worker-7]</span><br><span class="line">map: a1 [ForkJoinPool.commonPool-worker-7]</span><br><span class="line">forEach: A1 [ForkJoinPool.commonPool-worker-7]</span><br><span class="line">map: b1 [main]</span><br><span class="line">forEach: B1 [main]</span><br><span class="line">forEach: A2 [ForkJoinPool.commonPool-worker-5]</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>보시다시피 병렬 스트림은 ForkJoinPool스트림 작업을 실행하기 위해 공통에서 사용 가능한 모든 스레드를 사용합니다 .<br>특정 스레드가 실제로 사용되는 동작이 비 결정적이기 때문에 연속 실행에서 출력이 다를 수 있습니다.</p>
<p>추가 스트림 작업을 통해 예제를 확장 해 보겠습니다 sort</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ForkJoinPool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ParallelStream</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">   </span><br><span class="line">        Arrays.asList(<span class="string">&quot;a1&quot;</span>, <span class="string">&quot;a2&quot;</span>, <span class="string">&quot;b1&quot;</span>, <span class="string">&quot;c2&quot;</span>, <span class="string">&quot;c1&quot;</span>)</span><br><span class="line">                .parallelStream()</span><br><span class="line">                .filter(s -&gt; &#123;</span><br><span class="line">                    System.out.format(<span class="string">&quot;filter: %s [%s]\n&quot;</span>,</span><br><span class="line">                            s, Thread.currentThread().getName());</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;)</span><br><span class="line">                .map(s -&gt; &#123;</span><br><span class="line">                    System.out.format(<span class="string">&quot;map: %s [%s]\n&quot;</span>,</span><br><span class="line">                            s, Thread.currentThread().getName());</span><br><span class="line">                    <span class="keyword">return</span> s.toUpperCase();</span><br><span class="line">                &#125;)</span><br><span class="line">                .sorted((s1, s2) -&gt; &#123;</span><br><span class="line">                    System.out.format(<span class="string">&quot;sort: %s &lt;&gt; %s [%s]\n&quot;</span>,</span><br><span class="line">                            s1, s2, Thread.currentThread().getName());</span><br><span class="line">                    <span class="keyword">return</span> s1.compareTo(s2);</span><br><span class="line">                &#125;)</span><br><span class="line">                .forEach(s -&gt; System.out.format(<span class="string">&quot;forEach: %s [%s]\n&quot;</span>,</span><br><span class="line">                        s, Thread.currentThread().getName()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>결과는 처음에는 이상하게 보일 수 있습니다.</p>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">filter: b1 [main]</span><br><span class="line">filter: a1 [ForkJoinPool.commonPool-worker-7]</span><br><span class="line">map: a1 [ForkJoinPool.commonPool-worker-7]</span><br><span class="line">filter: a2 [ForkJoinPool.commonPool-worker-5]</span><br><span class="line">map: a2 [ForkJoinPool.commonPool-worker-5]</span><br><span class="line">filter: c1 [ForkJoinPool.commonPool-worker-3]</span><br><span class="line">map: c1 [ForkJoinPool.commonPool-worker-3]</span><br><span class="line">filter: c2 [ForkJoinPool.commonPool-worker-7]</span><br><span class="line">map: c2 [ForkJoinPool.commonPool-worker-7]</span><br><span class="line">map: b1 [main]</span><br><span class="line">sort: A2 &lt;&gt; A1 [main]</span><br><span class="line">sort: B1 &lt;&gt; A2 [main]</span><br><span class="line">sort: C2 &lt;&gt; B1 [main]</span><br><span class="line">sort: C1 &lt;&gt; C2 [main]</span><br><span class="line">sort: C1 &lt;&gt; B1 [main]</span><br><span class="line">sort: C1 &lt;&gt; C2 [main]</span><br><span class="line">forEach: B1 [main]</span><br><span class="line">forEach: A1 [ForkJoinPool.commonPool-worker-5]</span><br><span class="line">forEach: C2 [ForkJoinPool.commonPool-worker-3]</span><br><span class="line">forEach: A2 [ForkJoinPool.commonPool-worker-7]</span><br><span class="line">forEach: C1 [ForkJoinPool.commonPool-worker-5]</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>

<p>그 보인다 sort메인 스레드에서만 순차적으로 실행됩니다.<br>사실, sort병렬 스트림에서는 새로운 Java 8 메소드를 사용합니다 Arrays.parallelSort(). Javadoc 로 설명 했듯이이 방법은 정렬이 순차적으로 또는 병렬로 수행되는 경우 배열의 길이를 결정합니다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">지정된 배열의 길이가 최소 단위보다 작은 경우, 적절한 Arrays.sort 메소드를 사용해 소트됩니다.</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>reduce마지막 절의 예제로 돌아갑니다 . </p>
<p>우리는 이미 결합 자 함수가 병렬로만 호출되지만 순차 스트림에서는 호출하지 않는다는 것을 알았습니다. 실제로 어떤 스레드가 관련되어 있는지 살펴 봅시다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.github.sejoung.codetest.stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ForkJoinPool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ParallelStream</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">   </span><br><span class="line">        List&lt;Person&gt; persons = Arrays.asList(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Max&quot;</span>, <span class="number">18</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Peter&quot;</span>, <span class="number">23</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Pamela&quot;</span>, <span class="number">23</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;David&quot;</span>, <span class="number">12</span>));</span><br><span class="line"></span><br><span class="line">        persons</span><br><span class="line">                .parallelStream()</span><br><span class="line">                .reduce(<span class="number">0</span>,</span><br><span class="line">                        (sum, p) -&gt; &#123;</span><br><span class="line">                            System.out.format(<span class="string">&quot;accumulator: sum=%s; person=%s [%s]\n&quot;</span>,</span><br><span class="line">                                    sum, p, Thread.currentThread().getName());</span><br><span class="line">                            <span class="keyword">return</span> sum += p.age;</span><br><span class="line">                        &#125;,</span><br><span class="line">                        (sum1, sum2) -&gt; &#123;</span><br><span class="line">                            System.out.format(<span class="string">&quot;combiner: sum1=%s; sum2=%s [%s]\n&quot;</span>,</span><br><span class="line">                                    sum1, sum2, Thread.currentThread().getName());</span><br><span class="line">                            <span class="keyword">return</span> sum1 + sum2;</span><br><span class="line">                        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>콘솔 출력은 accumulator 와 combiner 함수가 모두 사용 가능한 모든 스레드에서 병렬로 실행 된다는 것을 보여줍니다 .</p>
<p>실행결과</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">accumulator: sum=0; person=Pamela [main]</span><br><span class="line">accumulator: sum=0; person=Max [ForkJoinPool.commonPool-worker-5]</span><br><span class="line">accumulator: sum=0; person=David [main]</span><br><span class="line">combiner: sum1=23; sum2=12 [main]</span><br><span class="line">accumulator: sum=0; person=Peter [ForkJoinPool.commonPool-worker-3]</span><br><span class="line">combiner: sum1=18; sum2=23 [ForkJoinPool.commonPool-worker-3]</span><br><span class="line">combiner: sum1=41; sum2=35 [ForkJoinPool.commonPool-worker-3]</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>
<p>요약하면 병렬 스트림을 사용하면 많은 양의 입력 요소가있는 스트림에 좋은 성능 향상을 가져올 수 있습니다. 그러나 일부 병렬 스트림 작업 은 순차적으로 실행될 때 필요하지 않은 추가 연산 (결합 연산)이 필요 reduce하고 마음에 드십시오 collect.</p>
<p>또한 모든 병렬 스트림 작업이 동일한 JVM 전체 공통을 공유한다는 것을 알았습니다 ForkJoinPool. 따라서 느린 블로킹 스트림 작업을 구현하지 않으려면 병렬 스트림에 많이 의존하는 응용 프로그램의 다른 부분을 느려질 수 있기 때문입니다.</p>
<h1 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h1><hr>
<ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://winterbe.com/posts/2014/07/31/java8-stream-tutorial-examples/">java8-stream-tutorial-examples</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html">java doc Stream</a></li>
</ul>
</div></article><div class="post-meta__tag-list"><a class="post-meta__tags" href="../../../tags/java-stream/">java stream</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="../../02/2019-02-07-Use_streams_judiciously/"><i class="fa fa-chevron-left">  </i><span>아이템 45. 스트림은 주의해서 사용해라</span></a></div><div class="next-post pull-right"><a href="../2019-01-30-interfaces_default_methods/"><span>인터페이스 default 메소드로 기존 인터페이스를 해치지 않게 확장 하기</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'https://sejoung.github.io/2019/01/2019-01-31-java8_stream_tutorial_examples/';
  this.page.identifier = '2019/01/2019-01-31-java8_stream_tutorial_examples/';
  this.page.title = 'java stream 예제';
}
var d = document, s = d.createElement('script');
s.src = "https://" + 'kimsejoung' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script><script id="dsq-count-scr" src="https://kimsejoung.disqus.com/count.js" async></script></div></div><footer class="footer-bg" style="background-image: url(https://upload.wikimedia.org/wikipedia/commons/thumb/0/09/Van_Gogh_-_Terrasse_des_Caf%C3%A9s_an_der_Place_du_Forum_in_Arles_am_Abend1.jpeg/1024px-Van_Gogh_-_Terrasse_des_Caf%C3%A9s_an_der_Place_du_Forum_in_Arles_am_Abend1.jpeg)"><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2024 By sejoung</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="external nofollow noopener noreferrer" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="../../../js/third-party/anime.min.js"></script><script src="../../../js/third-party/jquery.min.js"></script><script src="../../../js/third-party/jquery.fancybox.min.js"></script><script src="../../../js/third-party/velocity.min.js"></script><script src="../../../js/third-party/velocity.ui.min.js"></script><script src="../../../js/utils.js?version=1.7.0"></script><script src="../../../js/fancybox.js?version=1.7.0"></script><script src="../../../js/sidebar.js?version=1.7.0"></script><script src="../../../js/copy.js?version=1.7.0"></script><script src="../../../js/fireworks.js?version=1.7.0"></script><script src="../../../js/transition.js?version=1.7.0"></script><script src="../../../js/scroll.js?version=1.7.0"></script><script src="../../../js/head.js?version=1.7.0"></script><script src="../../../js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>