<!DOCTYPE html><html lang="lang"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="도커 처음 시작하기part5(Stacks)"><meta name="keywords" content="docker"><meta name="author" content="sejoung"><meta name="copyright" content="sejoung"><title>도커 처음 시작하기part5(Stacks) | 폭간의 기술블로그</title><link rel="shortcut icon" href="../../../my-favicon.ico"><link rel="stylesheet" href="../../../css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><script async src="https://www.googletagmanager.com/gtag/js?id=G-NVRTGLD8RZ"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-NVRTGLD8RZ');</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 5.4.2"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EB%8F%84%EC%BB%A4-%EC%B2%98%EC%9D%8C-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0-Stacks"><span class="toc-number">1.</span> <span class="toc-text">도커 처음 시작하기(Stacks)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%A0%84%EC%A0%9C%EC%A1%B0%EA%B1%B4"><span class="toc-number">1.1.</span> <span class="toc-text">전제조건</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%86%8C%EA%B0%9C"><span class="toc-number">1.2.</span> <span class="toc-text">소개</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%83%88-%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%B6%94%EA%B0%80-%EB%B0%8F-%EC%9E%AC%EB%B0%B0%ED%8F%AC"><span class="toc-number">1.3.</span> <span class="toc-text">새 서비스 추가 및 재배포</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%9C%A0%EC%A7%80"><span class="toc-number">1.4.</span> <span class="toc-text">데이터 유지</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Recap-and-cheat-sheet"><span class="toc-number">1.5.</span> <span class="toc-text">Recap and cheat sheet</span></a></li></ol></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#%EC%B0%B8%EC%A1%B0"><span class="toc-number"></span> <span class="toc-text">참조</span></a></li></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://avatars0.githubusercontent.com/u/4936005?s=400&amp;u=a679b941fe377418e7e4efcf916c6a636d7178ee&amp;v=4"></div><div class="author-info__name text-center">sejoung</div><div class="author-info__description text-center">잘정리하자</div><div class="follow-button"><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/sejoung">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="../../../archives"><span class="pull-left">Articles</span><span class="pull-right">719</span></a><a class="author-info-articles__tags article-meta" href="../../../tags"><span class="pull-left">Tags</span><span class="pull-right">776</span></a><a class="author-info-articles__categories article-meta" href="../../../categories"><span class="pull-left">Categories</span><span class="pull-right">74</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.naver.com/sanaes">naverblog</a><a class="author-info-links__name text-center" target="_blank" rel="external nofollow noopener noreferrer" href="https://www.linkedin.com/in/sanaes/">linkedin</a><a class="author-info-links__name text-center" target="_blank" rel="external nofollow noopener noreferrer" href="https://www.slideshare.net/sejoung">slideshare</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://upload.wikimedia.org/wikipedia/commons/thumb/0/09/Van_Gogh_-_Terrasse_des_Caf%C3%A9s_an_der_Place_du_Forum_in_Arles_am_Abend1.jpeg/1024px-Van_Gogh_-_Terrasse_des_Caf%C3%A9s_an_der_Place_du_Forum_in_Arles_am_Abend1.jpeg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="../../../index.html">폭간의 기술블로그</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">도커 처음 시작하기part5(Stacks)</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-03-14</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="../../../categories/tool/">tool</a><span class="post-meta__separator">|</span><i class="fa fa-comment-o post-meta__icon" aria-hidden="true"></i><a href="#disqus_thread"><span class="disqus-comment-count" data-disqus-identifier="2019/03/2019-03-14-docker-get-started_5/"></span></a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="도커-처음-시작하기-Stacks"><a href="#도커-처음-시작하기-Stacks" class="headerlink" title="도커 처음 시작하기(Stacks)"></a>도커 처음 시작하기(Stacks)</h2><h3 id="전제조건"><a href="#전제조건" class="headerlink" title="전제조건"></a>전제조건</h3><ul>
<li>Docker 버전 1.13 이상을 설치하십시오.</li>
<li><a href="https://sejoung.github.io/2019/03/2019-03-13-docker-get-started(1)/">도커 처음 시작하기part1(오리엔테이션 및 설정)</a> 에서 방향을 읽으십시오 .</li>
<li><a href="https://sejoung.github.io/2019/03/2019-03-13-docker-get-started(2)/">도커 처음 시작하기part2(컨테이너)</a> 에서 컨테이너를 만드는 방법에 대해 알아보십시오.</li>
<li><a href="https://sejoung.github.io/2019/03/2019-03-14-docker-get-started(3)/">도커 처음 시작하기part3(서비스)</a> 에서 서비스를 만드는 방법에 대해 알아보십시오 .</li>
<li>friendlyhello 이미지를 레지스트리 로 푸시 하여 게시했는지 확인하십시오. 우리는 여기에 그 공유 된 이미지를 사용합니다.</li>
<li>이미지가 배포 된 컨테이너로 작동하는지 확인하십시오. docker run -p 4000:80 username&#x2F;repo:tag 이 명령을 실행 다음 방문 <a target="_blank" rel="external nofollow noopener noreferrer" href="http://localhost:4000/">http://localhost:4000/</a>.</li>
<li>파트3 의 docker-compose.yml 파일을 가지고 있으면 편하다.</li>
<li><a href="https://sejoung.github.io/2019/03/2019-03-14-docker-get-started(4)/">도커 처음 시작하기part4(Stacks)</a> 에서 설정 한 기계 가 작동하고 준비 상태 인지 확인하십시오<br>이를 실행 docker-machine ls하여이를 확인하십시오. 시스템이 중지 된 경우, docker-machine start myvm1 관리자 를 부트 한 후 docker-machine start myvm2 작업자를 부트하십시오.</li>
<li><a href="https://sejoung.github.io/2019/03/2019-03-14-docker-get-started(4)/">도커 처음 시작하기part4(Stacks)</a> 에서 작성한 Swarm를 준비하고 준비하십시오.<br>이를 실행 docker-machine ssh myvm1 “docker node ls”하여이를 확인하십시오. 집단이 가동되면 두 노드 모두 ready상태를 보고합니다.<br>그렇지 않으면 떼를 다시 초기화에 설명 된대로 근로자에 가입 하여 떼를 설정합니다.</li>
</ul>
<h3 id="소개"><a href="#소개" class="headerlink" title="소개"></a>소개</h3><p>파트 4에서는 Docker를 실행하는 시스템 클러스터 인 swarm을 설정하고 컨테이너를 여러 컴퓨터에서 동시에 실행하여 응용 프로그램을 배포하는 방법을 배웠습니다.</p>
<p>여기 5 부에서는 분산 응용 프로그램 계층 구조의 최상위 인 스택에 도달했습니다.<br>스택은 종속성을 공유하고 함께 조정 및 확장 될 수있는 상호 연관된 서비스 그룹입니다.<br>단일 스택은 전체 응용 프로그램의 기능을 정의하고 조정할 수 있습니다 (매우 복잡한 응용 프로그램이 여러 스택을 사용할 수도 있음).</p>
<p>좋은 소식은 Compose 파일을 만들고 사용할 때 파트 3 이후로 스택을 사용하여 기술적으로 작업 한 것입니다 docker stack deploy.<br>그러나 이것은 단일 호스트에서 실행되는 단일 서비스 스택이었습니다.<br>이는 일반적으로 프로덕션 환경에서 발생하지 않습니다.<br>여기서 배운 것을 취하고 여러 서비스를 서로 관련 시키며 여러 시스템에서 실행할 수 있습니다.</p>
<p>너는 위대한 일을하고있다, 이것은 홈 스트레칭이다!</p>
<h3 id="새-서비스-추가-및-재배포"><a href="#새-서비스-추가-및-재배포" class="headerlink" title="새 서비스 추가 및 재배포"></a>새 서비스 추가 및 재배포</h3><p>docker-compose.yml파일 에 서비스를 추가하는 것은 쉽습니다.<br>먼저, 우리의 떼가 컨테이너를 어떻게 스케쥴 하는지를 볼 수있는 무료 시각화 서비스를 추가합시다.</p>
<ul>
<li>docker-compose.yml편집기에서 열어 내용을 다음과 같이 바꿉니다. username&#x2F;repo:tag이미지 세부 정보 로 바꾸 십시오.</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="comment"># replace username/repo:tag with your name and image details</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">sejoung/get-started:part2</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">replicas:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">limits:</span></span><br><span class="line">          <span class="attr">cpus:</span> <span class="string">&quot;0.1&quot;</span></span><br><span class="line">          <span class="attr">memory:</span> <span class="string">50M</span></span><br><span class="line">      <span class="attr">restart_policy:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">on-failure</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;80:80&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">webnet</span></span><br><span class="line">  <span class="attr">visualizer:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">dockersamples/visualizer:stable</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span> [<span class="string">node.role</span> <span class="string">==</span> <span class="string">manager</span>]</span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">webnet</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">webnet:</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>여기에 새로운 유일하게 할 수있는 피어 서비스입니다 web, 이름 visualizer.<br>A : 여기에 두 가지 새로운 것을 주목 volumes 호스트의 소켓 고정 표시기에 대한 파일과의 비주얼 액세스 제공 키를 placement 결코 노동자 -이 서비스는 오직 떼 관리자에서 실행 보장, 키를 누릅니다.<br>Docker 에 의해 생성 된 오픈 소스 프로젝트를 기반으로 구축 된이 컨테이너 는 다이어그램의 덩치에서 실행되는 Docker 서비스를 표시하기 때문입니다.</p>
<p>우리는 잠시 배치 제약과 볼륨에 대해 더 자세히 이야기합니다.</p>
<ul>
<li><p>셸이 대화 할 수 있도록 구성되어 있는지 확인하십시오 myvm1(전체 예제는 여기에 있습니다 ).</p>
<ul>
<li>실행 옆에있는 별표로 표시된대로 docker-machine ls기계를 나열하고 연결되어 있는지 확인하십시오 myvm1</li>
<li>필요한 경우 다시 실행 docker-machine env myvm1한 다음 주어진 명령을 실행하여 셸을 구성하십시오.</li>
</ul>
</li>
<li><p>docker stack deploy관리자 에게 명령을 다시 실행하고 업데이트가 필요한 서비스를 업데이트합니다.</p>
</li>
</ul>
<p><code>docker stack deploy -c docker-compose.yml getstartedlab</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">C:\Users\ASUS&gt;docker stack deploy -c docker-compose.yml getstartedlab</span><br><span class="line">Creating network getstartedlab_webnet</span><br><span class="line">Creating service getstartedlab_visualizer</span><br><span class="line">Creating service getstartedlab_web</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>시각화 프로그램을 살펴보십시오.</li>
</ul>
<p>당신은 visualizer포트 8080에서 실행 되는 작성 파일을 보았습니다 docker-machine ls.<br>실행하여 노드 중 하나의 IP 주소를 가져옵니다 .<br>포트 8080의 IP 주소로 가면 다음과 같이 실행중인 visualizer를 볼 수 있습니다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\ASUS&gt;docker-machine ls</span><br><span class="line">NAME    ACTIVE   DRIVER       STATE     URL                         SWARM   DOCKER     ERRORS</span><br><span class="line">myvm1   *        virtualbox   Running   tcp://192.168.99.100:2376           v18.09.3</span><br><span class="line">myvm2   -        virtualbox   Running   tcp://192.168.99.101:2376           v18.09.3</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://192.168.99.100:8080/">http://192.168.99.100:8080/</a></li>
</ul>
<p>visualizer예상대로 관리자 의 단일 복사본 이 실행 중이며 5 개의 인스턴스가 web웜 전체에 퍼져 있습니다.<br>다음을 실행하여이 시각화를 확인할 수 있습니다 docker stack ps <stack>.</stack></p>
<p><code>docker stack ps getstartedlab</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">C:\Users\ASUS&gt;docker stack ps getstartedlab</span><br><span class="line">ID                  NAME                         IMAGE                             NODE                DESIRED STATE       CURRENT STATE                ERROR               PORTS</span><br><span class="line">y67cyv06zqo0        getstartedlab_web.1          sejoung/get-started:part2         myvm2               Running             Running 2 minutes ago        </span><br><span class="line">me02mia19ocr        getstartedlab_visualizer.1   dockersamples/visualizer:stable   myvm1               Running             Running about a minute ago   </span><br><span class="line">trl14ue06ed2        getstartedlab_web.2          sejoung/get-started:part2         myvm2               Running             Running 2 minutes ago        </span><br><span class="line">a194uv4k9e2a        getstartedlab_web.3          sejoung/get-started:part2         myvm1               Running             Running 2 minutes ago        </span><br><span class="line">oxq1qres79rs        getstartedlab_web.4          sejoung/get-started:part2         myvm2               Running             Running 2 minutes ago        </span><br><span class="line">tey916ohzm52        getstartedlab_web.5          sejoung/get-started:part2         myvm1               Running             Running 2 minutes ago   </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>비주얼 라이저는 스택에 포함 된 모든 앱에서 실행할 수있는 독립 실행 형 서비스입니다.<br>그것은 다른 것에 의존하지 않습니다.<br>이제 서비스를 만들 수 않는 방문자 카운터를 제공하는 레디 스 서비스 : 종속성을 가지고 있습니다.</p>
<h3 id="데이터-유지"><a href="#데이터-유지" class="headerlink" title="데이터 유지"></a>데이터 유지</h3><p>다시 한 번 같은 워크 플로우를 통해 앱 데이터 저장을위한 Redis 데이터베이스를 추가하십시오.</p>
<ul>
<li>이 새 docker-compose.yml파일을 저장하면 마지막으로 Redis 서비스가 추가됩니다. username&#x2F;repo:tag이미지 세부 정보 로 바꾸 십시오.</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="comment"># replace username/repo:tag with your name and image details</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">sejoung/get-started:part2</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">replicas:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">limits:</span></span><br><span class="line">          <span class="attr">cpus:</span> <span class="string">&quot;0.1&quot;</span></span><br><span class="line">          <span class="attr">memory:</span> <span class="string">50M</span></span><br><span class="line">      <span class="attr">restart_policy:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">on-failure</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;80:80&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">webnet</span></span><br><span class="line">  <span class="attr">visualizer:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">dockersamples/visualizer:stable</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span> [<span class="string">node.role</span> <span class="string">==</span> <span class="string">manager</span>]</span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">webnet</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6379:6379&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;/home/docker/data:/data&quot;</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span> [<span class="string">node.role</span> <span class="string">==</span> <span class="string">manager</span>]</span><br><span class="line">    <span class="attr">command:</span> <span class="string">redis-server</span> <span class="string">--appendonly</span> <span class="literal">yes</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">webnet</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">webnet:</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Redis는 Docker 라이브러리에 공식 이미지가 있으며 여기 에는 image그냥 짧은 이름 이 부여 redis되어 있으므로 username&#x2F;repo여기 에는 표기가 없습니다 .<br>Redis 포트 6379는 컨테이너에서 호스트로 노출되도록 Redis에 의해 사전 구성되어 있습니다.<br>여기에서 Compose 파일에는 호스트에서 전세계로 노출되므로 실제로 호스트의 IP 주소를 입력 할 수 있습니다.<br>노드를 Redis Desktop Manager로 가져 와서 Redis 인스턴스를 관리하십시오.</p>
<p>가장 중요한 redis점 은이 스팩의 배치 사이에 데이터를 지속 시키는 두 가지 사항 이있다.</p>
<ul>
<li>redis 항상 매니저에서 실행되므로 항상 동일한 파일 시스템을 사용합니다.</li>
<li>redis&#x2F;dataRedis가 데이터를 저장하는 컨테이너 내부 에서 호스트의 파일 시스템에있는 임의의 디렉토리에 액세스합니다 .</li>
</ul>
<p>함께, Redis 데이터를위한 호스트의 물리적 파일 시스템에 “진실의 근원”을 만듭니다.<br>이 기능이 없으면 Redis는 &#x2F;data 컨테이너의 파일 시스템 내부에 데이터를 저장 합니다.<br>컨테이너의 파일 시스템이 재배포 된 경우에는 사라집니다.</p>
<p>이 진리의 근원에는 두 가지 구성 요소가 있습니다.</p>
<ul>
<li>Redis 서비스에 배치 한 배치 제약 조건. 항상 동일한 호스트를 사용합니다.</li>
<li>컨테이너가 .&#x2F;data(호스트에서) 액세스 할 수있게 만든 볼륨 &#x2F;data(Redis 컨테이너 내부). 컨테이너가오고가는 동안 .&#x2F;data지정된 호스트에 저장된 파일이 계속 유지되어 연속성을 유지합니다</li>
</ul>
<p>새로운 Redis-using 스택을 배포 할 준비가되었습니다.</p>
<ul>
<li>.&#x2F;data관리자에 디렉토리를 만듭니다 .</li>
</ul>
<p><code>docker-machine ssh myvm1 &quot;mkdir ./data&quot;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\ASUS&gt;docker-machine ssh myvm1 &quot;mkdir ./data&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>셸이 대화 할 수 있도록 구성되어 있는지 확인하십시오 myvm1(전체 예제는 여기에 있습니다 ).</p>
<ul>
<li><p>실행 옆에있는 별표로 표시된대로 docker-machine ls기계를 나열하고 연결되어 있는지 확인하십시오 myvm1.</p>
</li>
<li><p>필요한 경우 다시 실행 docker-machine env myvm1한 다음 주어진 명령을 실행하여 셸을 구성하십시오.</p>
</li>
</ul>
</li>
<li><p>docker stack deploy한 번 더 실행하십시오 .</p>
</li>
</ul>
<p><code>docker stack deploy -c docker-compose.yml getstartedlab</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\ASUS&gt;docker stack deploy -c docker-compose.yml getstartedlab</span><br><span class="line">Updating service getstartedlab_visualizer (id: b2tkyi7pce9x7a172ifvfmhty)</span><br><span class="line">Creating service getstartedlab_redis</span><br><span class="line">Updating service getstartedlab_web (id: 6ctq2dzu0xjvjznqsg11fplxi)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>실행 docker service ls 하여 세 가지 서비스가 예상대로 실행되는지 확인합니다.</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\ASUS&gt;docker service ls</span><br><span class="line">ID                  NAME                       MODE                REPLICAS            IMAGE                             PORTS</span><br><span class="line">tpjcqpbuxzz4        getstartedlab_redis        replicated          1/1                 redis:latest                      *:6379-&gt;6379/tcp</span><br><span class="line">b2tkyi7pce9x        getstartedlab_visualizer   replicated          1/1                 dockersamples/visualizer:stable   *:8080-&gt;8080/tcp</span><br><span class="line">6ctq2dzu0xjv        getstartedlab_web          replicated          5/5                 sejoung/get-started:part2         *:80-&gt;80/tcp</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://192.168.99.100/">http://192.168.99.100</a> 와 같은 노드 중 하나에서 웹 페이지를 확인하고 현재 살아있는 방문자 카운터 결과를보고 Redis에 대한 정보를 저장하십시오.</li>
</ul>
<p>또한 노드의 IP 주소에서 포트 8080의 비주얼 라이저를 확인 redis하고 web및 visualizer서비스 와 함께 실행중인 서비스를 확인하십시오 .</p>
<h3 id="Recap-and-cheat-sheet"><a href="#Recap-and-cheat-sheet" class="headerlink" title="Recap and cheat sheet"></a>Recap and cheat sheet</h3><p>스택은 상호 연관성이있는 모든 서비스가 콘서트에서 실행된다는 것을 배웠습니다.<br>-이 튜토리얼의 3 부 이후로 스택을 사용 해왔다.<br>스택에 더 많은 서비스를 추가하려면 Compose 파일에 서비스를 삽입하는 방법을 배웠습니다.<br>마지막으로, 배치 제약 조건과 볼륨의 조합을 사용하면 데이터를 영구 저장하기위한 영구적 인 홈을 생성 할 수 있으므로 컨테이너가 해체되어 재배치 될 때도 앱의 데이터가 유지됩니다</p>
<h1 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h1><hr>
<ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.docker.com/get-started/part4/">docker-get-started</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.virtualbox.org/wiki/Downloads">virtualbox Downloads</a></li>
</ul>
</div></article><div class="post-meta__tag-list"><a class="post-meta__tags" href="../../../tags/docker/">docker</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="../2019-03-15-Item_66_Use_native_methods_judiciously/"><i class="fa fa-chevron-left">  </i><span>아이템 66. 네이티브 매서드는 신중히 사용하라.</span></a></div><div class="next-post pull-right"><a href="../2019-03-14-docker-get-started_4/"><span>도커 처음 시작하기part4(Swarm)</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'https://sejoung.github.io/2019/03/2019-03-14-docker-get-started_5/';
  this.page.identifier = '2019/03/2019-03-14-docker-get-started_5/';
  this.page.title = '도커 처음 시작하기part5(Stacks)';
}
var d = document, s = d.createElement('script');
s.src = "https://" + 'kimsejoung' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script><script id="dsq-count-scr" src="https://kimsejoung.disqus.com/count.js" async></script></div></div><footer class="footer-bg" style="background-image: url(https://upload.wikimedia.org/wikipedia/commons/thumb/0/09/Van_Gogh_-_Terrasse_des_Caf%C3%A9s_an_der_Place_du_Forum_in_Arles_am_Abend1.jpeg/1024px-Van_Gogh_-_Terrasse_des_Caf%C3%A9s_an_der_Place_du_Forum_in_Arles_am_Abend1.jpeg)"><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2023 By sejoung</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="external nofollow noopener noreferrer" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="../../../js/third-party/anime.min.js"></script><script src="../../../js/third-party/jquery.min.js"></script><script src="../../../js/third-party/jquery.fancybox.min.js"></script><script src="../../../js/third-party/velocity.min.js"></script><script src="../../../js/third-party/velocity.ui.min.js"></script><script src="../../../js/utils.js?version=1.7.0"></script><script src="../../../js/fancybox.js?version=1.7.0"></script><script src="../../../js/sidebar.js?version=1.7.0"></script><script src="../../../js/copy.js?version=1.7.0"></script><script src="../../../js/fireworks.js?version=1.7.0"></script><script src="../../../js/transition.js?version=1.7.0"></script><script src="../../../js/scroll.js?version=1.7.0"></script><script src="../../../js/head.js?version=1.7.0"></script><script src="../../../js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>