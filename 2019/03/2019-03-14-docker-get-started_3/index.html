<!DOCTYPE html><html lang="lang"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="도커 처음 시작하기part3(서비스)"><meta name="keywords" content="docker"><meta name="author" content="sejoung"><meta name="copyright" content="sejoung"><title>도커 처음 시작하기part3(서비스) | 폭간의 기술블로그</title><link rel="shortcut icon" href="../../../my-favicon.ico"><link rel="stylesheet" href="../../../css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><script async src="https://www.googletagmanager.com/gtag/js?id=G-NVRTGLD8RZ"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-NVRTGLD8RZ');</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 5.4.2"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EB%8F%84%EC%BB%A4-%EC%B2%98%EC%9D%8C-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0-%EC%84%9C%EB%B9%84%EC%8A%A4"><span class="toc-number">1.</span> <span class="toc-text">도커 처음 시작하기(서비스)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%A0%84%EC%A0%9C%EC%A1%B0%EA%B1%B4"><span class="toc-number">1.1.</span> <span class="toc-text">전제조건</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%86%8C%EA%B0%9C"><span class="toc-number">1.2.</span> <span class="toc-text">소개</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#services-%EB%9E%80"><span class="toc-number">1.3.</span> <span class="toc-text">services 란?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EB%8B%B9%EC%8B%A0%EC%9D%98-%EC%B2%AB%EB%B2%88%EC%A7%B8-docker-compose-yml"><span class="toc-number">1.4.</span> <span class="toc-text">당신의 첫번째 docker-compose.yml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EB%8B%B9%EC%8B%A0%EC%9D%98-%EC%83%88%EB%A1%AD%EA%B2%8C-load-balanced-app%EC%9D%84-%EC%8B%A4%ED%96%89"><span class="toc-number">1.5.</span> <span class="toc-text">당신의 새롭게 load-balanced app을 실행</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Scale-the-app"><span class="toc-number">1.6.</span> <span class="toc-text">Scale the app</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#app-%EA%B3%BC-swarm%EB%A5%BC-%EC%A4%91%EC%A7%80%ED%95%98%EB%8A%94%EB%B2%95"><span class="toc-number">1.6.1.</span> <span class="toc-text">app 과 swarm를 중지하는법</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Recap-and-cheat-sheet"><span class="toc-number">1.7.</span> <span class="toc-text">Recap and cheat sheet</span></a></li></ol></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#%EC%B0%B8%EC%A1%B0"><span class="toc-number"></span> <span class="toc-text">참조</span></a></li></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://avatars0.githubusercontent.com/u/4936005?s=400&amp;u=a679b941fe377418e7e4efcf916c6a636d7178ee&amp;v=4"></div><div class="author-info__name text-center">sejoung</div><div class="author-info__description text-center">잘정리하자</div><div class="follow-button"><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/sejoung">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="../../../archives"><span class="pull-left">Articles</span><span class="pull-right">717</span></a><a class="author-info-articles__tags article-meta" href="../../../tags"><span class="pull-left">Tags</span><span class="pull-right">773</span></a><a class="author-info-articles__categories article-meta" href="../../../categories"><span class="pull-left">Categories</span><span class="pull-right">74</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.naver.com/sanaes">naverblog</a><a class="author-info-links__name text-center" target="_blank" rel="external nofollow noopener noreferrer" href="https://www.linkedin.com/in/sanaes/">linkedin</a><a class="author-info-links__name text-center" target="_blank" rel="external nofollow noopener noreferrer" href="https://www.slideshare.net/sejoung">slideshare</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://upload.wikimedia.org/wikipedia/commons/thumb/0/09/Van_Gogh_-_Terrasse_des_Caf%C3%A9s_an_der_Place_du_Forum_in_Arles_am_Abend1.jpeg/1024px-Van_Gogh_-_Terrasse_des_Caf%C3%A9s_an_der_Place_du_Forum_in_Arles_am_Abend1.jpeg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="../../../index.html">폭간의 기술블로그</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">도커 처음 시작하기part3(서비스)</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-03-14</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="../../../categories/tool/">tool</a><span class="post-meta__separator">|</span><i class="fa fa-comment-o post-meta__icon" aria-hidden="true"></i><a href="#disqus_thread"><span class="disqus-comment-count" data-disqus-identifier="2019/03/2019-03-14-docker-get-started_3/"></span></a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="도커-처음-시작하기-서비스"><a href="#도커-처음-시작하기-서비스" class="headerlink" title="도커 처음 시작하기(서비스)"></a>도커 처음 시작하기(서비스)</h2><h3 id="전제조건"><a href="#전제조건" class="headerlink" title="전제조건"></a>전제조건</h3><ul>
<li>Docker 버전 1.13 이상을 설치하십시오.</li>
<li><a href="https://sejoung.github.io/2019/03/2019-03-13-docker-get-started(1)/">도커 처음 시작하기part1(오리엔테이션 및 설정)</a> 에서 방향을 읽으십시오 .</li>
<li><a href="https://sejoung.github.io/2019/03/2019-03-13-docker-get-started(2)/">도커 처음 시작하기part2(컨테이너)</a> 에서 컨테이너를 만드는 방법에 대해 알아보십시오 .</li>
<li>friendlyhello 이미지를 레지스트리 로 푸시 하여 게시했는지 확인하십시오. 우리는 여기에 그 공유 된 이미지를 사용합니다.</li>
<li>이미지가 배포 된 컨테이너로 작동하는지 확인하십시오. docker run -p 4000:80 username&#x2F;repo:tag 이 명령을 실행 다음 방문 <a target="_blank" rel="external nofollow noopener noreferrer" href="http://localhost:4000/">http://localhost:4000/</a>.</li>
</ul>
<h3 id="소개"><a href="#소개" class="headerlink" title="소개"></a>소개</h3><p>3 부에서는 응용 프로그램을 확장하고로드 균형 조정을 활성화합니다.<br>이렇게하려면, 우리는 분산 응용 프로그램의 계층 구조에서 한 단계 위로 이동해야 서비스 .</p>
<ul>
<li>스택</li>
<li>서비스 (현재 위치)</li>
<li>컨테이너 ( 2 부 적용 )</li>
</ul>
<h3 id="services-란"><a href="#services-란" class="headerlink" title="services 란?"></a>services 란?</h3><p>분산 응용 프로그램에서 응용 프로그램의 다른 부분을 “서비스”라고합니다.<br>예를 들어 비디오 공유 사이트를 상상하면 데이터베이스에 응용 프로그램 데이터를 저장하는 서비스,<br>사용자가 무언가를 업로드 한 후 백그라운드에서 비디오 트랜스 코딩을 위한 서비스, 프런트 엔드를위한 서비스 등이 포함됩니다.</p>
<p>서비스는 실제로 “프로덕션 컨테이너”입니다.<br>서비스는 하나의 이미지 만 실행하지만 이미지를 실행하는 방식을 체계화합니다.<br>사용할 포트 수, 실행해야하는 컨테이너의 복제본 수, 서비스에 필요한 용량이 있습니다.<br>곧. 서비스를 확장하면 해당 소프트웨어를 실행하는 컨테이너 인스턴스 수가 변경되어 프로세스의 서비스에 더 많은 컴퓨팅 리소스가 할당됩니다.</p>
<p>다행히도 Docker 플랫폼으로 서비스를 정의, 실행 및 확장하는 것은 매우 쉽습니다. 단지 <code>docker-compose.yml</code> 파일을 작성하는 것뿐입니다.</p>
<h3 id="당신의-첫번째-docker-compose-yml"><a href="#당신의-첫번째-docker-compose-yml" class="headerlink" title="당신의 첫번째 docker-compose.yml"></a>당신의 첫번째 docker-compose.yml</h3><p><code>docker-compose.yml</code> 파일은 도커 용기 생산에서 행동하는 방법을 정의하는 YAML 파일입니다.</p>
<p>당신이 2 부에서 레지스트리에 이미지 밀어넣어 만든을 username&#x2F;repo:tag 이미지의 세부 사항을 대체하여 docker-compose.yml 파일로 저장하십시오.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="comment"># replace username/repo:tag with your name and image details</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">sejoung/get-started:part2</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">replicas:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">limits:</span></span><br><span class="line">          <span class="attr">cpus:</span> <span class="string">&quot;0.1&quot;</span></span><br><span class="line">          <span class="attr">memory:</span> <span class="string">50M</span></span><br><span class="line">      <span class="attr">restart_policy:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">on-failure</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;4000:80&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">webnet</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">webnet:</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>이 docker-compose.yml 파일은 Docker에게 다음을 수행하도록 지시합니다.</p>
<ul>
<li>2 단계 에서 업로드 한 이미지를 레지스트리 에서 당겨 냅니다.</li>
<li>해당 이미지의 인스턴스 5 개를 호출 한 서비스로 실행합니다.<br>web 각 프로세스마다 최대 CPU 시간의 10 %를 사용하도록 제한합니다 (예를 들어 1.5는 1 그리고 절반의 core를 의미 할 수 있음)<br>그리고 메모리는 50MB 로 제한.</li>
<li>컨테이너가 실패하면 즉시 다시 시작하십시오.</li>
<li>호스트의 포트 4000을 web 포트 80 에 매핑하십시오 .</li>
<li>web 로드 밸런싱 네트워크를 통해 포트 80을 공유하도록 지시 webnet합니다.<br>(내부적으로 컨테이너 자체 web는 임시 포트에서 80 번 포트에 게시합니다.)</li>
<li>webnet기본 설정 (로드 균형 조정 된 오버레이 네트워크)으로 네트워크를 정의합니다.</li>
</ul>
<h3 id="당신의-새롭게-load-balanced-app을-실행"><a href="#당신의-새롭게-load-balanced-app을-실행" class="headerlink" title="당신의 새롭게 load-balanced app을 실행"></a>당신의 새롭게 load-balanced app을 실행</h3><p><code>docker stack deploy</code> 명령을 사용하기 전에 먼저 다음을 실행합니다.</p>
<p><code>docker swarm init</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\ASUS&gt;docker swarm init</span><br><span class="line">Swarm initialized: current node (jhdqx8g4oy354du0w0zruox2d) is now a manager.</span><br><span class="line"></span><br><span class="line">To add a worker to this swarm, run the following command:</span><br><span class="line"></span><br><span class="line">    docker swarm join --token SWMTKN-1-6bh8cw13hw27w6mi4brpn9b75c6i9tb7xu7cxmg19gdlqikaz7-cm5437fthnhpl4ekp92taggfm 192.168.65.3:2377</span><br><span class="line"></span><br><span class="line">To add a manager to this swarm, run &#x27;docker swarm join-token manager&#x27; and follow the instructions.</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">참고 : 우리는 4 장 에서 그 명령의 의미를 이해합니다. </span><br><span class="line">docker swarm init 실행하지 않으면 &quot;이 노드는 군집 관리자가 아닙니다.&quot;라는 오류가 표시됩니다.</span><br></pre></td></tr></table></figure>

<p>이제 실행 해 봅시다. 앱에 이름을 지정해야합니다. 여기서는 다음과 같이 설정됩니다 getstartedlab.</p>
<p><code>docker stack deploy -c docker-compose.yml getstartedlab</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">C:\Users\ASUS&gt;docker stack deploy -c docker-compose.yml getstartedlab</span><br><span class="line">Creating network getstartedlab_webnet</span><br><span class="line">Creating service getstartedlab_web</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>단일 서비스 스택은 배포 된 이미지의 컨테이너 인스턴스 5 개를 하나의 호스트에서 실행합니다.<br>조회 해보자.</p>
<p>애플리케이션에서 하나의 서비스에 대한 서비스 ID를 얻습니다.</p>
<p><code>docker service ls</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">C:\Users\ASUS&gt;docker service ls</span><br><span class="line">ID                  NAME                MODE                REPLICAS            IMAGE                       PORTS</span><br><span class="line">4v3l89msqs5q        getstartedlab_web   replicated          5/5                 sejoung/get-started:part2   *:4000-&gt;80/tcp</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>web앱 이름이 앞에 붙은 출력을 찾으십시오.<br>이 예제에서와 같이 이름을 지정한 경우 이름은 getstartedlab_web입니다.<br>서비스 ID는 복제본 수, 이미지 이름 및 노출 된 포트와 함께 나열됩니다.</p>
<p>또는 실행 한 <code>docker stack services</code> 다음 스택 이름을 입력 할 수도 있습니다.<br>다음 예제 명령을 사용하면 getstartedlab스택 과 관련된 모든 서비스를 볼 수 있습니다 .</p>
<p><code>docker stack services getstartedlab</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\ASUS&gt;docker stack services getstartedlab</span><br><span class="line">ID                  NAME                MODE                REPLICAS            IMAGE                       PORTS</span><br><span class="line">4v3l89msqs5q        getstartedlab_web   replicated          5/5                 sejoung/get-started:part2   *:4000-&gt;80/tcp</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>서비스에서 실행되는 단일 컨테이너를 태스크 라고합니다.<br>작업에는 replicas 정의 된 번호까지 숫자가 증가하는 고유 ID가 부여 됩니다 docker-compose.yml.<br>서비스 작업을 나열하십시오.</p>
<p><code>docker service ps getstartedlab_web</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\ASUS&gt;docker service ps getstartedlab_web</span><br><span class="line">ID                  NAME                  IMAGE                       NODE                    DESIRED STATE       CURRENT STATE           ERROR               PORTS</span><br><span class="line">i5e11rbs5vsx        getstartedlab_web.1   sejoung/get-started:part2   linuxkit-00155d849805   Running             Running 3 minutes ago</span><br><span class="line">qxkkd1tvv04a        getstartedlab_web.2   sejoung/get-started:part2   linuxkit-00155d849805   Running             Running 3 minutes ago</span><br><span class="line">y82ouma09vkp        getstartedlab_web.3   sejoung/get-started:part2   linuxkit-00155d849805   Running             Running 3 minutes ago</span><br><span class="line">mih5f81tkv37        getstartedlab_web.4   sejoung/get-started:part2   linuxkit-00155d849805   Running             Running 3 minutes ago</span><br><span class="line">ze8zvepzzfwu        getstartedlab_web.5   sejoung/get-started:part2   linuxkit-00155d849805   Running             Running 3 minutes ago</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>또한 서비스에 의해 필터링되지 않지만 시스템의 모든 컨테이너를 나열하면 작업도 표시됩니다.</p>
<p><code>docker container ls -q</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">C:\Users\ASUS&gt;docker container ls -q</span><br><span class="line">8c5cbf9e90ec</span><br><span class="line">d6be9f49b9b5</span><br><span class="line">fe5bf146e643</span><br><span class="line">b1128e43062c</span><br><span class="line">a659caef8af4</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>curl -4 <a href="http://localhost:4000를" rel="external nofollow noopener noreferrer" target="_blank">http://localhost:4000를</a> 여러번 실행하거나<br>브라우저에서 <a target="_blank" rel="external nofollow noopener noreferrer" href="http://localhost:4000/">http://localhost:4000</a> 접속해 새로고침을 몇번 누릅니다.</p>
<p>어느 쪽이든 컨테이너 ID가 변경되어로드 밸런싱을 시연합니다.<br>각 요청마다 5 가지 작업 중 하나가 라운드 로빈 방식으로 응답하도록 선택됩니다.<br>컨테이너 ID는 이전 명령 ( docker container ls -q) 의 결과와 일치합니다 .</p>
<p>스택의 모든 작업을 보려면 docker stack ps 다음 예제와 같이 앱 이름을 실행하면 됩니다.</p>
<p><code>docker stack ps getstartedlab</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">C:\Users\ASUS&gt;docker stack ps getstartedlab</span><br><span class="line">ID                  NAME                  IMAGE                       NODE                    DESIRED STATE       CURRENT STATE           ERROR               PORTS</span><br><span class="line">e0gkjae059wp        getstartedlab_web.1   sejoung/get-started:part2   linuxkit-00155d849806   Running             Running 2 minutes ago</span><br><span class="line">z8y4larl3i4n        getstartedlab_web.2   sejoung/get-started:part2   linuxkit-00155d849806   Running             Running 2 minutes ago</span><br><span class="line">9lfo61f811oy        getstartedlab_web.3   sejoung/get-started:part2   linuxkit-00155d849806   Running             Running 2 minutes ago</span><br><span class="line">vim5d0qer25e        getstartedlab_web.4   sejoung/get-started:part2   linuxkit-00155d849806   Running             Running 2 minutes ago</span><br><span class="line">iz4nckx24brq        getstartedlab_web.5   sejoung/get-started:part2   linuxkit-00155d849806   Running             Running 2 minutes ago</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Scale-the-app"><a href="#Scale-the-app" class="headerlink" title="Scale the app"></a>Scale the app</h3><p>docker-compose.yml의 replicas값을 변경하고 변경 사항을 저장하고<br>docker stack deploy 명령을 다시 실행하여 앱의 크기를 조절할 수 있습니다 .</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="comment"># replace username/repo:tag with your name and image details</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">sejoung/get-started:part2</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">limits:</span></span><br><span class="line">          <span class="attr">cpus:</span> <span class="string">&quot;0.1&quot;</span></span><br><span class="line">          <span class="attr">memory:</span> <span class="string">50M</span></span><br><span class="line">      <span class="attr">restart_policy:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">on-failure</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;4000:80&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">webnet</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">webnet:</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3개로 조절함</p>
<p><code>docker stack deploy -c docker-compose.yml getstartedlab</code> 실행</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\ASUS&gt;docker stack deploy -c docker-compose.yml getstartedlab</span><br><span class="line">Updating service getstartedlab_web (id: 6mvrx34uhboi9ft8592ald5pg)</span><br></pre></td></tr></table></figure>
<p>Docker는 전체 업데이트를 수행하므로 먼저 스택을 떼어 내거나 컨테이너를 제거 할 필요가 없습니다.</p>
<p>이제 재실행 docker container ls -q하여 배포 된 인스턴스가 재구성되었는지 확인하십시오.<br>복제본을 확장하면 더 많은 태스크가 생겨서 더 많은 컨테이너가 시작됩니다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\ASUS&gt;docker container ls -q</span><br><span class="line">1c24aa19ea07</span><br><span class="line">44ec1a846e85</span><br><span class="line">c5fe0fb3e6ba</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="app-과-swarm를-중지하는법"><a href="#app-과-swarm를-중지하는법" class="headerlink" title="app 과 swarm를 중지하는법"></a>app 과 swarm를 중지하는법</h4><p>앱 중지 <code>docker stack rm</code></p>
<p><code>docker stack rm getstartedlab</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\ASUS&gt;docker stack rm getstartedlab</span><br><span class="line">Removing service getstartedlab_web</span><br><span class="line">Removing network getstartedlab_webnet</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>swarm 중지 </p>
<p><code>docker swarm leave --force</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">C:\Users\ASUS&gt;docker swarm leave --force</span><br><span class="line">Node left the swarm.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Docker로 앱을 세우고 확장하는 것은 간단합니다.<br>프로덕션 환경에서 컨테이너를 실행하는 방법을 배우는 데 큰 걸음을 딛었습니다.<br>다음으로, Docker 시스템 클러스터에서이 애플리케이션을 보나 피드 뭉치로 실행하는 법을 배웁니다.</p>
<h3 id="Recap-and-cheat-sheet"><a href="#Recap-and-cheat-sheet" class="headerlink" title="Recap and cheat sheet"></a>Recap and cheat sheet</h3><p>다시 말해, 입력 docker run이 간단하면서도 프로덕션에서 컨테이너를 실제로 구현하면 서비스로 실행됩니다.<br>서비스는 Compose 파일의 컨테이너 동작을 코드화하며, 이 파일을 사용하여 앱을 확장, 제한 및 재배포 할 수 있습니다.<br>서비스 변경은 서비스를 시작한 동일한 명령을 사용하여 실행하면서 그대로 적용 할 수 있습니다 docker stack deploy.</p>
<p>이 단계에서 탐색 할 수있는 명령은 다음과 같습니다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">docker stack ls                                            # List stacks or apps</span><br><span class="line">docker stack deploy -c &lt;composefile&gt; &lt;appname&gt;  # Run the specified Compose file</span><br><span class="line">docker service ls                 # List running services associated with an app</span><br><span class="line">docker service ps &lt;service&gt;                  # List tasks associated with an app</span><br><span class="line">docker inspect &lt;task or container&gt;                   # Inspect task or container</span><br><span class="line">docker container ls -q                                      # List container IDs</span><br><span class="line">docker stack rm &lt;appname&gt;                             # Tear down an application</span><br><span class="line">docker swarm leave --force      # Take down a single node swarm from the manager</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h1><hr>
<ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.docker.com/get-started/part3/">docker-get-started</a></li>
<li><a href="https://sejoung.github.io/2019/03/Overview_of_Docker_Compose">Docker Compose 개요</a></li>
</ul>
</div></article><div class="post-meta__tag-list"><a class="post-meta__tags" href="../../../tags/docker/">docker</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="../2019-03-14-docker-get-started_4/"><i class="fa fa-chevron-left">  </i><span>도커 처음 시작하기part4(Swarm)</span></a></div><div class="next-post pull-right"><a href="../2019-03-14-Overview_of_Docker_Compose/"><span>Docker Compose 개요</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'https://sejoung.github.io/2019/03/2019-03-14-docker-get-started_3/';
  this.page.identifier = '2019/03/2019-03-14-docker-get-started_3/';
  this.page.title = '도커 처음 시작하기part3(서비스)';
}
var d = document, s = d.createElement('script');
s.src = "https://" + 'kimsejoung' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script><script id="dsq-count-scr" src="https://kimsejoung.disqus.com/count.js" async></script></div></div><footer class="footer-bg" style="background-image: url(https://upload.wikimedia.org/wikipedia/commons/thumb/0/09/Van_Gogh_-_Terrasse_des_Caf%C3%A9s_an_der_Place_du_Forum_in_Arles_am_Abend1.jpeg/1024px-Van_Gogh_-_Terrasse_des_Caf%C3%A9s_an_der_Place_du_Forum_in_Arles_am_Abend1.jpeg)"><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2023 By sejoung</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="external nofollow noopener noreferrer" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="../../../js/third-party/anime.min.js"></script><script src="../../../js/third-party/jquery.min.js"></script><script src="../../../js/third-party/jquery.fancybox.min.js"></script><script src="../../../js/third-party/velocity.min.js"></script><script src="../../../js/third-party/velocity.ui.min.js"></script><script src="../../../js/utils.js?version=1.7.0"></script><script src="../../../js/fancybox.js?version=1.7.0"></script><script src="../../../js/sidebar.js?version=1.7.0"></script><script src="../../../js/copy.js?version=1.7.0"></script><script src="../../../js/fireworks.js?version=1.7.0"></script><script src="../../../js/transition.js?version=1.7.0"></script><script src="../../../js/scroll.js?version=1.7.0"></script><script src="../../../js/head.js?version=1.7.0"></script><script src="../../../js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>