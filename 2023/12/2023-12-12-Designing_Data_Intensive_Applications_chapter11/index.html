<!DOCTYPE html><html lang="lang"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="11장: 스트림 처리"><meta name="keywords" content="데이터 중심 애플리케이션 설계,Designing Data Intensive Applications"><meta name="author" content="sejoung"><meta name="copyright" content="sejoung"><title>11장: 스트림 처리 | 폭간의 기술블로그</title><link rel="shortcut icon" href="../../../my-favicon.ico"><link rel="stylesheet" href="../../../css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><script async src="https://www.googletagmanager.com/gtag/js?id=G-NVRTGLD8RZ"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-NVRTGLD8RZ');</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 5.4.2"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%ED%8C%8C%EC%83%9D-%EB%8D%B0%EC%9D%B4%ED%84%B0"><span class="toc-number">1.</span> <span class="toc-text">파생 데이터</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#11%EC%9E%A5-%EC%8A%A4%ED%8A%B8%EB%A6%BC-%EC%B2%98%EB%A6%AC"><span class="toc-number">1.1.</span> <span class="toc-text">11장: 스트림 처리</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%9D%B4%EB%B2%A4%ED%8A%B8-%EC%8A%A4%ED%8A%B8%EB%A6%BC-%EC%A0%84%EC%86%A1"><span class="toc-number">1.1.1.</span> <span class="toc-text">이벤트 스트림 전송</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4%EC%99%80-%EC%8A%A4%ED%8A%B8%EB%A6%BC"><span class="toc-number">1.1.2.</span> <span class="toc-text">데이터베이스와 스트림</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%8A%A4%ED%8A%B8%EB%A6%BC-%EC%B2%98%EB%A6%AC"><span class="toc-number">1.1.3.</span> <span class="toc-text">스트림 처리</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%A0%95%EB%A6%AC"><span class="toc-number">1.1.4.</span> <span class="toc-text">정리</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%EC%B0%B8%EC%A1%B0"><span class="toc-number">2.</span> <span class="toc-text">참조</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://avatars0.githubusercontent.com/u/4936005?s=400&amp;u=a679b941fe377418e7e4efcf916c6a636d7178ee&amp;v=4"></div><div class="author-info__name text-center">sejoung</div><div class="author-info__description text-center">잘정리하자</div><div class="follow-button"><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/sejoung">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="../../../archives"><span class="pull-left">Articles</span><span class="pull-right">854</span></a><a class="author-info-articles__tags article-meta" href="../../../tags"><span class="pull-left">Tags</span><span class="pull-right">860</span></a><a class="author-info-articles__categories article-meta" href="../../../categories"><span class="pull-left">Categories</span><span class="pull-right">77</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.naver.com/sanaes">naverblog</a><a class="author-info-links__name text-center" target="_blank" rel="external nofollow noopener noreferrer" href="https://www.linkedin.com/in/sanaes/">linkedin</a><a class="author-info-links__name text-center" target="_blank" rel="external nofollow noopener noreferrer" href="https://www.slideshare.net/sejoung">slideshare</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://upload.wikimedia.org/wikipedia/commons/thumb/0/09/Van_Gogh_-_Terrasse_des_Caf%C3%A9s_an_der_Place_du_Forum_in_Arles_am_Abend1.jpeg/1024px-Van_Gogh_-_Terrasse_des_Caf%C3%A9s_an_der_Place_du_Forum_in_Arles_am_Abend1.jpeg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="../../../index.html">폭간의 기술블로그</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">11장: 스트림 처리</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-12-12</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="../../../categories/books/">books</a><span class="post-meta__separator">|</span><i class="fa fa-comment-o post-meta__icon" aria-hidden="true"></i><a href="#disqus_thread"><span class="disqus-comment-count" data-disqus-identifier="2023/12/2023-12-12-Designing_Data_Intensive_Applications_chapter11/"></span></a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="파생-데이터"><a href="#파생-데이터" class="headerlink" title="파생 데이터"></a>파생 데이터</h1><h2 id="11장-스트림-처리"><a href="#11장-스트림-처리" class="headerlink" title="11장: 스트림 처리"></a>11장: 스트림 처리</h2><p>“복잡하지만 잘 작동하는 시스템은 예외 없이 간단하지만 잘 작동하는 시스템으로부터 발전한다.<br>이 명제는 역도 참이다. 처음부터 복잡하게 설계된 시스템은 절대 작동할 리도 없고 작동하게 만들지도 못한다.” 존갈, 체계론</p>
<p>일괄처리는 입력으로 파일 집합을 읽어 출력으로 새로운 파일 집합을 생성하는 기술 출력은 파생데이터 형태</p>
<p>일괄처리의 문제는 입력의 변화가 하루가 지나야 반영된다는것</p>
<p>이벤트가 발생할때 마다 처리하는것 - 스트림처리</p>
<h3 id="이벤트-스트림-전송"><a href="#이벤트-스트림-전송" class="headerlink" title="이벤트 스트림 전송"></a>이벤트 스트림 전송</h3><p>스트림 처리에서 레코드 -&gt; 이벤트</p>
<p>이벤트는 특정 시점에 일어난 사건에 대한 세부 사항을 포함하는 작고 독립된 불변 객체</p>
<p>이벤트는 일반적으로 일기준 시계를 따르는 이벤트 발생 타임스템프를 포함한다</p>
<p>일괄처리에서 파일은 한번 기록하면 여러 작업에서 읽을 수 있다 스트리밍에서도 비슷하다</p>
<p>폴링은 비용이 크다. 폴링이 잦을수록 새로운 이벤트를 반환하는 요청비율이 낮아지기 때문에 폴링을 수행하는 오버헤드가 커진다</p>
<ul>
<li>메시징 시스템<ul>
<li>발행,구독 모델</li>
<li>메시지 유실을 허용할지 말지는 애플리케이션에 따라서 틀리다</li>
<li>생산자에서 소비자로 메시지 직접 전달하기<ul>
<li>생산자와 소비자가 항상 온라인이라고 가정한다</li>
</ul>
</li>
<li>메시지 브로커(메시지 큐)<ul>
<li>메시지 스트림을 처리하는 데 최적화된 데이터베이스의 일종</li>
<li>비동기식으로 작동</li>
</ul>
</li>
<li>메시지 브로커와 데이터베이스의 비교<ul>
<li>데이터 베이스는 명시적으로 데이터가 삭제될 때까지 데이터를 보관한다. 메시지 브로커는 소비자에게 메시지가 전달 되면 대부분 삭제한다</li>
<li>메시지 브로커는 대부분 메시지를 빨리 지우기 때문에 작업 집합이 상당히 작다고 가정한다</li>
<li>데이터 베이스는 보조색인을 지원하고 데이터 검색을 위한 다양한 방법을 지원하는 반면 메시지 브로커는 특정 패턴과 부합하는 토픽의 부분 집합을 구동하는 방식을 지원한다</li>
<li>데이터베이스에 질의 할때 그 결과는 질의 시점의 스냅숏을 기준으로 한다. 메시지 브로커는 데이터가 변하면 클라이언트에게 알려준다</li>
</ul>
</li>
<li>복수 소비자<ul>
<li>로드 밸런싱 : 메시지는 한 소비자에게 전달 된다</li>
<li>팬 아웃 : 메시지는 여러 소비자에게 전달 된다</li>
</ul>
</li>
<li>확인 응답과 재전동<ul>
<li>메시지 브로커는 확인 응답을 사용한다</li>
<li>메시지 순서는 메시지가 서로 독립적이라면 문제가 없지만 메시지간의 인과성이 있다면 매우 중요한 문제이다</li>
</ul>
</li>
</ul>
</li>
<li>파티셔닝된 로그<ul>
<li>로그 기반의 메시지 브로커</li>
<li>로그를 사용한 메시지 저장소<ul>
<li>로그는 단순히 디스크에 저장된 추가 전용 레코드의 연속이다</li>
<li>디스크 하나를 쓸때 처리량을 높이기 위해 확장하는 방법으로 로그를 파티셔닝 하는 방법이 있다</li>
</ul>
</li>
<li>로그 방식과 전통적인 메시지 방식의 비교<ul>
<li>메시지를 처리하는 비용이 비싸고 메시지 단위로 병렬화 처리하고 싶지만 메시지 순서는 구렇게 중요하지 않다면 JMS&#x2F;AMQP 같은 메시징 시스템을 사용하는 것이 좋다</li>
<li>메시지 순서가 중요하고 메시지 처리량이 많으면 로그기반 접근법이 효과적이다</li>
</ul>
</li>
<li>소비자 오프셋<ul>
<li>메시지 오프셋은 로그 순차 번호와 상당히 유사</li>
</ul>
</li>
<li>디스크 공간 사용<ul>
<li>로그는 크기가 제한된 버퍼로 구현하고 버퍼가 가득 차면 오래된 메시지 순서대로 삭제한다 </li>
<li>원형 버퍼 또는 링 버퍼라고 한다</li>
</ul>
</li>
<li>소비자가 생산자를 따라갈 수 없을 때<ul>
<li>메시지 버리기</li>
<li>버퍼링</li>
<li>배압 적용</li>
</ul>
</li>
<li>오래된 메시지 재상<ul>
<li>오프셋의 이동</li>
<li>일괄처리와 비슷</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="데이터베이스와-스트림"><a href="#데이터베이스와-스트림" class="headerlink" title="데이터베이스와 스트림"></a>데이터베이스와 스트림</h3><p>상태 기계 복제</p>
<ul>
<li>시스템 동기화 유지하기<ul>
<li>데이터 덤프는 너무 느려서 이중기록(dual write)의 방법도 있다<ul>
<li>이중쓰기는 하나만 성공할수도 있다</li>
</ul>
</li>
</ul>
</li>
<li>변경 데이터 캡처<ul>
<li>CDC(Change Data Capture)는 데이터베이스의 변경 사항을 캡처하는 방법이다</li>
<li>변경 데이터 캡처의 구현<ul>
<li>로그 기반의 CDC</li>
<li>트리거 기반의 CDC</li>
<li>스냅샷 기반의 CDC</li>
</ul>
</li>
<li>초기 스냅숏<ul>
<li>로그를 모두 플레이해서 재생하는것은 시간이 너무 오래 걸림</li>
<li>적당히 짤라서 처리해야함</li>
</ul>
</li>
<li>로그 컴팩션<ul>
<li>log compaction</li>
</ul>
</li>
<li>변경 스트림용 API 지원</li>
</ul>
</li>
<li>이벤트 소싱<ul>
<li>이벤트 소싱은 변경 데이터 캡처의 일종이다</li>
<li>데이터 모델링에 쓸수 있는 강력한 기법</li>
<li>이벤트 로그에서 현재 상태 파생하기</li>
<li>명령과 이벤트<ul>
<li>명령은 시스템의 상태를 변경하는 요청</li>
<li>이벤트는 시스템에서 일어난 사건의 사실을 기록</li>
</ul>
</li>
</ul>
</li>
<li>상태와 스트림과 불변성<ul>
<li>모든 변경로그(changelog)는 시간에 따라 변화하는 값</li>
<li>불변이벤트의 장점<ul>
<li>문제 상황의 진단과 복구가 훨씬 쉽다</li>
<li>불변이벤트는 현재 상태보다 훨씬 많은 정보를 포함한다</li>
</ul>
</li>
<li>동일한 이벤트 로그로 여러 가지 뷰 만들기<ul>
<li>CQRS(Command Query Responsibility Segregation)</li>
</ul>
</li>
<li>동시성 제어<ul>
<li>이벤트 소싱과 CDC의 단점은 비동기로 이루어진다는 것이다</li>
</ul>
</li>
<li>불변성의 한계<ul>
<li>데이터를 삭제하는것 - 이벤트를 추가해서 되는것이 아니다<ul>
<li>데이토믹 : 적출(exicision)</li>
<li>포씰 : 셔닝(shunning)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="스트림-처리"><a href="#스트림-처리" class="headerlink" title="스트림 처리"></a>스트림 처리</h3><p>일괄처리랑 다른 점은 스트림은 끝나지 않는다</p>
<ul>
<li>스트림 처리의 사용<ul>
<li>사기 감사 시스템</li>
<li>거래 시스템</li>
<li>제조 시스템 공장 기계 상태 모니터링</li>
<li>군사 첩보 시스템</li>
<li>복잡한 이벤트 처리<ul>
<li>CEP(Complex Event Processing)</li>
</ul>
</li>
<li>스트림 분석</li>
<li>구체화뷰 유지</li>
<li>스트림 상에서 검색하기</li>
<li>메시지 전달과 RPC</li>
</ul>
</li>
<li>시간에 관한 추론<ul>
<li>이벤트 시간 대 처리 시간</li>
<li>준비 여부 인식<ul>
<li>낙오자 이벤트 처리 -&gt; 무시, 수정 값 발행</li>
</ul>
</li>
<li>어쨋든 어떤 시계를 사용할 것인가<ul>
<li>시스템 시계</li>
<li>외부 시계</li>
<li>이벤트 시계</li>
</ul>
</li>
<li>원도우 유형<ul>
<li>덤블링 원도우(tumbling window) : 모든 이벤트는 정확히 한 원도우에 속한다</li>
<li>홉핑 원도우(hopping window) : 이벤트는 여러 원도우에 속할 수 있다</li>
<li>슬라이딩 원도우(sliding window) : 각 시간 간격 사이에서 발생한 모든 이벤트를 포함 한다</li>
<li>세션 윈도우(session window) : 고정된 기간이 없다</li>
</ul>
</li>
</ul>
</li>
<li>스트림 조인<ul>
<li>스트림 스트림 조인(stream-stream join) - 원도우 조인<ul>
<li>클릭 이벤트와 구매 이벤트를 조인 광고에서</li>
</ul>
</li>
<li>스트림 테이블 조인(stream-table join) - 스트림 강화<ul>
<li>데이터 베이스 정보로 이벤트 강화</li>
</ul>
</li>
<li>테이블 테이블 조인(table-table join) - 구체화 뷰 유지<ul>
<li>조인의 시간 의존성<ul>
<li>천천히 변하는 차원(slowlly changing dimension)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>내결함성<ul>
<li>정확히 한 번 시맨틱</li>
<li>결과적으로 한 번 시맨틱</li>
<li>마이크로 일괄 처리와 체크포인트</li>
<li>원자적 커밋 재검토</li>
<li>멱등성</li>
<li>실패 후에 상태 재구축하기</li>
</ul>
</li>
</ul>
<h3 id="정리"><a href="#정리" class="headerlink" title="정리"></a>정리</h3><ul>
<li>amqp&#x2F;jms 스타일 메시지 브로커</li>
<li>로그 기반 메시지 브로커</li>
<li>스트림 스트림 조인</li>
<li>스트림 테이블 조인 </li>
<li>테이블 테이블 조인</li>
</ul>
<h1 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h1><hr>
<ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://wikibook.co.kr/data-intensive-applications-ebook/">데이터 중심 애플리케이션 설계</a></li>
</ul>
</div></article><div class="post-meta__tag-list"><a class="post-meta__tags" href="../../../tags/%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A4%91%EC%8B%AC-%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98-%EC%84%A4%EA%B3%84/">데이터 중심 애플리케이션 설계</a><a class="post-meta__tags" href="../../../tags/Designing-Data-Intensive-Applications/">Designing Data Intensive Applications</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="../2023-12-13-python_pyenv/"><i class="fa fa-chevron-left">  </i><span>Simple Python Version Management: pyenv</span></a></div><div class="next-post pull-right"><a href="../2023-12-07-Designing_Data_Intensive_Applications_chapter10/"><span>10장: 일괄 처리</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'https://sejoung.github.io/2023/12/2023-12-12-Designing_Data_Intensive_Applications_chapter11/';
  this.page.identifier = '2023/12/2023-12-12-Designing_Data_Intensive_Applications_chapter11/';
  this.page.title = '11장: 스트림 처리';
}
var d = document, s = d.createElement('script');
s.src = "https://" + 'kimsejoung' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script><script id="dsq-count-scr" src="https://kimsejoung.disqus.com/count.js" async></script></div></div><footer class="footer-bg" style="background-image: url(https://upload.wikimedia.org/wikipedia/commons/thumb/0/09/Van_Gogh_-_Terrasse_des_Caf%C3%A9s_an_der_Place_du_Forum_in_Arles_am_Abend1.jpeg/1024px-Van_Gogh_-_Terrasse_des_Caf%C3%A9s_an_der_Place_du_Forum_in_Arles_am_Abend1.jpeg)"><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2024 By sejoung</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="external nofollow noopener noreferrer" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="../../../js/third-party/anime.min.js"></script><script src="../../../js/third-party/jquery.min.js"></script><script src="../../../js/third-party/jquery.fancybox.min.js"></script><script src="../../../js/third-party/velocity.min.js"></script><script src="../../../js/third-party/velocity.ui.min.js"></script><script src="../../../js/utils.js?version=1.7.0"></script><script src="../../../js/fancybox.js?version=1.7.0"></script><script src="../../../js/sidebar.js?version=1.7.0"></script><script src="../../../js/copy.js?version=1.7.0"></script><script src="../../../js/fireworks.js?version=1.7.0"></script><script src="../../../js/transition.js?version=1.7.0"></script><script src="../../../js/scroll.js?version=1.7.0"></script><script src="../../../js/head.js?version=1.7.0"></script><script src="../../../js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>