---
layout: post
title: "mariadb_change_problem"
date: 2018-03-26 09:00:00 +0900
comments: false
sitemap :
  changefreq : daily
  priority : 1.0
---

## 마리아 DB 교체후 장애 사항 대처

운영중인 시스템에서 mariadb를 사용하고 있는데 디스크가 98%까지 찼다, 
예상은 하고 있었는데 차주 화요일로 교체시기를 예상하고 있었지만 주말에 디스크 확보를 보장하기 어려워 바로 교체하는 작업을 했다.
교체이후에 문제가 없는줄 알고 있던 시스템에서 하나씩 장애가 발생하기 시작했다.
가장 큰 문제는 옵티마이저에서 발생하고 있었다  cost-based로 움직이는 옵티마이저에서 다르게 판단되고 있다고 생각하여서
STRAIGHT_JOIN 을 넣어서 처리하라고 했다.

여기서 궁금증이 나왔다.

1. 기존 DB에서 마이그레이션 작업을 했을때 통계DB까지 다 옴겨졌냐?( 답변 : 옴겨 졌다. DB 덤프를 떠서 옴겼다고 함)
2. 그럼 통계정보가 변경된것이 있냐?(인덱스작업과, 데이터 삭제 작업을 진행했다.)
3. 그럼 문제된 쿼리에서 테이블에 새로운 인텍스가 걸린것이 있냐?(없다.)

위에 질문에서 더이상 질문 하지 못한것이 있다.

4. 삭제 작업을 한다고 해서 통계정보가 바뀌냐?(기존 DB에는 영향이 없음, 부과적으로 삭제한다고 해서 테이블 스페이스가 다시 돌아 오는것읕 아니다 최적화시에 돌아오는데 이때바뀔꺼로 예상함)

아 궁금한것이 많은데 찾아보질 못함 ㅜㅜ

p.s : 궁금해 죽겠는데 제대로 된 답변이 안됨 샤머니즘으로 끝난듯 해서 아쉽다. 

# 참조
-----
* [mariadb optimizer-switch](https://mariadb.com/kb/en/library/index-hints-how-to-force-query-plans/#optimizer-switch)
